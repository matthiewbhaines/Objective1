# 1:10 Sourness {#Sour10}
This will be the data analysis and results of the 1:10 nose closed study run in December 2024 and the 1:10 nose open study run in September 2023 on sourness.  
You can refer to the 1:10 Bitterness results [here](#Bitter10).  

A 1:10 brew strength (coffee:water, w/w) is representative of a strong ratio used by everyday consumers. Our hypotheses was:  

> Milk will reduce the sourness of cold brew coffee more than water  

This hypothesis is thought to be seen regardless of condition (nose closed or nose open). 

Some interpretations of expected data would be:

- In the nose closed condition a reduction in sourness from the milky coffee would suggest a physicochemical interaction between the milk and coffee  
- Milk, being 86% water [@walstraDairyTechnologyPrinciples1999] could have a similar effect as water would when added to coffee   
- In the nose opened condition, a reduction in sourness from the milky coffee could suggest a cross-modal interaction (particularly if no effect is seen in the nose closed condition) 

## Nose Closed Condition
```{r study2library, message=FALSE, warning=FALSE, include=FALSE}
# data wrangling
library(plyr)
library(tidyverse) # data wrangling
library(str2str) # R viz wrangling
library(readxl) # read in data
library(Rmisc) # summarySE()
library(agricolae) #LSD test
library(janitor) #clean_names()
library(tibble)

#visualizations
library(ggplot2) # plotting
library(grid) # adjusting axes on plots
library(ggsignif) #add signif to plots
library(cowplot) #combining plots
library(patchwork)
library(knitr)
```
```{r study2Rcriti, include=FALSE}
# R-index is a non-parametric test related to the Whitney *U* and the Wilcox *W* test.
# It recreates a ROC (receiver operating characteristic) curve based on choice/confidence data.
# The statistic can be interpreted as the proportion of people who chose sample Y over X, *P(X \< Y)*.
# From @biRindexCriticalValue2020

Rcriti<- function(nc, nt, alpha, side) {#R-index critical value in difference testing, i.e.,rc=â€‰100*(Rc-0.5); Rc=0.5+rc/100

#nc, nt are sample sizes of the control sample and the test sample

#alpha is a significance level; side=1 is a one-sided test and side=2 is two-sided test

#See, @biUpdatedExtendedTable2007

if(side==2){

z <- qnorm(1 - alpha/2)}

if(side==1)

{z<-qnorm(1-alpha)}

rcf <- function(Rc, nc, nt, z)

{

q1 <- Rc/(2 - Rc)

q2 <- (2 * Rc^2)/(1 + Rc)

va <- Rc * (1 - Rc) + (nt - 1) * (q1 - Rc^2) + (nc - 1) * (q2 - Rc^2)

va <- va/(nc * nt)

s <- sqrt(va)

(Rc - 0.5)/s - z

}

Rc <- uniroot(rcf, interval = c(0.5, 0.9999), nc = nc, nt = nt, z = z)

Rc <- Rc[[1]]

rc <- 100 * (Rc - 0.5)

rc <- round(rc, 2)

rc

cat("rc and Rc values:","/n")

all<-c(rc,Rc)

all<-round(all,2)

all

}
```
```{r study2RIndex, include=FALSE}
RIndex <- function(a,b,c,d,e,f,n) {
# a = S!, b = S, c = S?
# d = N?, e = N, f = N!, n = sample size
  aa <- a*(a+b+c+d+e)
  bb <- b*(a+b+c+d)
  cc <- c*(a+b+c)
  dd <- d*(a+b)
  ee <- e*a
  prod <- .5*((a*f)+ (b*e)+ (c*d)+ (c*d)+ (b*e)+ (a*f))
  denom <- (n^2)
  
  index<- sum(aa,bb,cc,dd,ee,prod)/denom 
  #formula from [@omahonySensoryEvaluationFood1986]
  
  if (1-index >= 0.5){
    r <- 1-index
    print(c(r, "Signal")) #this says which S/N was > 50%
  } else {
    r <- index
    print(c(r, "Noise")) #this says which S/N was > 50%
  }
}
```

### Participant Data 
```{r study2closedMeta}
Study1Meta <- read_xlsx(path = "Objective1CompiledDataWithIndex.xlsx", sheet = 4) %>% clean_names()
colnames(Study1Meta)

Study1Meta %>% filter(consumption == "6") #osu27
# 1 - daily; 2 - 2-3/wk; 3- 1/wk
# 4 - 2-3/mo; 5 - 1/mo; 6 <1/mo
```

- one participant (F) drank coffee less frequently than once a month. therefore they will be removed

```{r study2closed characteristics}
Study1MetaInc <- Study1Meta %>% filter(panelist_code != "osu27")
describe(Study1MetaInc)[2,] %>% select(mean, sd, median, min, max) #age

Study1MetaInc %>% count(gender) # 11 males, 18 females

Study1MetaInc %>% group_by(sweetener, whitener) %>% 
  tally() %>% 
  spread(whitener, n) %>% 
  replace(is.na(.), 0)
# 11 - whiten and sweeten
# 12 - whiten, no sweeten
# 21 - sweeten, no whiten
# 22 - black coffee drinker

Study1MetaInc %>% count(consumption)
# 1 - daily; 2 - 2-3/wk; 3- 1/wk
# 4 - 2-3/mo; 5 - 1/mo; 6 <1/mo
```


### R Index  
```{r study2closed data wrangling, include=FALSE}
brew10closedsour <- read_xlsx(path = "Objective1CompiledDataWithIndex.xlsx", sheet = 3) 
# ~/ not necessary when in working directory, just use "filename.xlsx"

brew10closedsour <- t(brew10closedsour) %>% as.data.frame() %>% row_to_names(row_number = 1) %>% clean_names()
chars <- sapply(brew10closedsour, is.character)
brew10closedsour[ ,chars] <- as.data.frame(apply(brew10closedsour[,chars],2, as.numeric))
# turn data frame from char to numeric

brew10closedsour <- brew10closedsour %>% rownames_to_column(var = "participant")
# create participant column

brew10closedsour <- brew10closedsour %>% filter(participant != "osu27")

```

The critical value for a 2-tailed test is **`r round(Rcriti(length(brew10closedsour$participant), length(brew10closedsour$participant), 0.05, 1)[2],2)`**.  

```{r study2closed rindex milks, echo=FALSE, include=FALSE}
Rcriti(length(brew10closedsour$participant), length(brew10closedsour$participant), 0.05, 2)
```
```{r study2closed 8% milk, include=FALSE}
brew10closedsour %>% select(comparison_19_v_21_more_sour, confidence) %>% count(comparison_19_v_21_more_sour, confidence)
Milk10S8CSour <- RIndex(6,6,3,1,5,8,length(brew10closedsour$participant)) 
```

- no discrimination seen between when 8% skim milk and 8% whole milk was added to coffee (R Index = `r round(as.numeric(Milk10S8CSour)[1], 2)`, p > 0.05)  

```{r study2closed 17% milk, include=FALSE}
brew10closedsour %>% select(comparison_13_v_15_more_sour, confidence_15) %>% count(comparison_13_v_15_more_sour, confidence_15)
Milk10S17CSour <- RIndex(7,4,3,3,5,7,length(brew10closedsour$participant))
```

- no discrimination between 17% skim milk or 17% whole milk added to coffee, (R Index = `r round(as.numeric(Milk10S17CSour)[1], 2)`, p > 0.05)  

```{r study2closed r wrangling milk, include=FALSE}
Milk10RSour <- tibble(
  Sample = "sample",
  Percent = factor(c("8% Addition", "17% Addition"),
                   levels = c("8% Addition", "17% Addition")),
  Condition = "Closed",
  Rindex = c(as.numeric(v2d(Milk10S8CSour, along = 1)$V1), as.numeric(v2d(Milk10S17CSour, along = 1)$V1)),
  Critical = as.numeric(Rcriti(length(brew10closedsour$participant), length(brew10closedsour$participant), 0.05, 2)[2]),
  S.N = c((v2d(Milk10S8CSour, along = 1)$V2), (v2d(Milk10S17CSour, along = 1)$V2)),
  Sig = ifelse(Rindex > Critical & S.N == "Signal", "#B22222",
               ifelse(Rindex > Critical & S.N == "Noise", "white",
                      "#888888"))
  )

rcritical_10Sour <- Milk10RSour %>% filter(Percent == "8% Addition")


study2closedMilkRViz <- Milk10RSour %>% 
  ggplot(aes(x = Sample, y = Rindex)) +
  geom_col(width = 0.5, fill = Milk10RSour$Sig, color = "black") +
  facet_grid(~Percent) +
  scale_y_continuous(expand = expansion(mult = c(0, .1)), labels = scales::percent) +
  scale_x_discrete(labels = c("Skim/Whole", "Skim/Whole")) +
  geom_hline(aes(yintercept = Critical), linetype = "longdash") +
  theme_bw() +
  labs(y = "R Index", x = "Sample") +
  geom_text(data = rcritical_10Sour,
            label = "R-crit", aes(y = 0.7, x = 0.6), size = 3) +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.text = element_text(size = 12), # facet text size
        axis.text = element_text(size = 10), # axis text size
        axis.title.y = element_text(size = 12),
        axis.title.x=element_blank(),
        strip.background.y = element_blank(),
        strip.text.y = element_blank()) +
  coord_cartesian(ylim = c(.5, 1)) 

```
```{r study2ClosedMilkRViz, echo=FALSE}
#| fig.cap = "R Index of paired comparison between skim milk and whole milk at an 8% addition level and 17% addition level in a nose closed condition. Dashed horizontal line represents the critical value, which denotes statistical significance, or discrimination between the samples on sourness. Grey bars are not significant (p > 0.05). Red bars indicate the water sample ('Signal') was significant; White bars indicate the milk sample ('Noise') was significant (p < 0.05)."
study2closedMilkRViz
```

For the paired comparisons between milk and water, we hypothesized that the addition of milk would reduce the sourness, therefore making the water sample the more sour. The critical value for a one tailed R-index calculation is **`r round(Rcriti(length(brew10closedsour$participant), length(brew10closedsour$participant), 0.05, 1)[2], 2)`**.  

```{r study2closed rindex water, echo=FALSE, include=FALSE}
Rcriti(length(brew10closedsour$participant), length(brew10closedsour$participant), 0.05, 1)
```

```{r study2closed 8% water, include=FALSE}
brew10closedsour %>% select(comparison_20_v_23_more_sour, confidence_23) %>% count(comparison_20_v_23_more_sour, confidence_23)
water10S8CSour <- RIndex(2,3,2,3,1,18,length(brew10closedsour$participant))
Rcriti(length(brew10closedsour$participant), length(brew10closedsour$participant), 0.001, 1)

brew10closedsour %>% select(comparison_22_v_24_more_sour, confidence_24) %>% count(comparison_22_v_24_more_sour, confidence_24)
water10W8CSour <- RIndex(4,3,1,1,3,17,length(brew10closedsour$participant))
Rcriti(length(brew10closedsour$participant), length(brew10closedsour$participant), 0.001, 1)
```

- discrimination seen between when 8% skim milk and 8% water was added to coffee (R Index = `r round(as.numeric(water10S8CSour)[1], 2)`, p $\le$ **0.001**)  

- discrimination seen between when 8% whole milk and 8% water was added to coffee (R Index = `r round(as.numeric(water10W8CSour)[1], 2)`, p $\le$ **0.001**)   

```{r study2closed 17 water, include=FALSE}
brew10closedsour %>% select(comparison_14_v_17_more_sour, confidence_17) %>% count(comparison_14_v_17_more_sour, confidence_17)
water10S17CSour <- RIndex(5,0,0,1,4,19,length(brew10closedsour$participant))
Rcriti(length(brew10closedsour$participant), length(brew10closedsour$participant), 0.001, 1)

brew10closedsour %>% select(comparison_16_v_18_more_sour, confidence_18) %>% count(comparison_16_v_18_more_sour, confidence_18)
water10W17CSour <- RIndex(3,2,2,0,1,21,length(brew10closedsour$participant))
Rcriti(length(brew10closedsour$participant), length(brew10closedsour$participant), 0.001, 1)
```

- discrimination between the 17% skim milk and 17% water samples (R Index = `r round(as.numeric(water10S17CSour)[1], 2)`, p $\le$ **0.001**)  
- discrimination between the 17% whole milk and 17% water samples (R Index = `r round(as.numeric(water10W17CSour)[1], 2)`, p $\le$ **0.001**)  

```{r study2closed r wrangling water, include=FALSE, warning=FALSE, message=FALSE}
Water10RSour <- tibble(
  Sample = factor(c(rep(c("S17", "S18"),2))),
  Percent = factor(c(rep("8% Addition",2), rep("17% Addition",2)),
                   levels = c("8% Addition", "17% Addition")),
  Condition = "Closed",  
  Rindex = c(as.numeric(v2d(water10S8CSour, along = 1)$V1),
             as.numeric(v2d(water10W8CSour, along = 1)$V1),
             as.numeric(v2d(water10S17CSour, along = 1)$V1),
             as.numeric(v2d(water10W17CSour, along = 1)$V1)),
  S.N = c((v2d(water10S8CSour, along = 1)$V2),
             (v2d(water10W8CSour, along = 1)$V2),
             (v2d(water10S17CSour, along = 1)$V2),
             (v2d(water10W17CSour, along = 1)$V2)),
  Critical = as.numeric(Rcriti(length(brew10closedsour$participant), length(brew10closedsour$participant), 0.05, 1)[2]),
  Sig = ifelse(Rindex > Critical & S.N == "Signal", "#B22222",
               ifelse(Rindex > Critical & S.N == "Noise", "white",
                      "#888888"))
  )

compareE <- Water10RSour %>% 
  filter(Sig %in% "#B22222")

rcritical_10WSour <- Water10RSour %>% filter(Sample == "S17" & Percent == "8% Addition")


study2closedWaterRViz <- Water10RSour %>% 
  ggplot(aes(x = Sample, y = Rindex)) +
  geom_col(width = 0.5, fill = Water10RSour$Sig, color = "black") +
  facet_grid(~Percent) +
  scale_y_continuous(expand = expansion(mult = c(0, .1)), labels = scales::percent) +
  geom_hline(aes(yintercept = Critical), linetype = "longdash") +
  theme_bw() +
  labs(y = "R Index", x = "Sample") +
  scale_x_discrete(labels = c("Skim/Water", "Whole/Water", "Skim/Water", "Whole/Water")) +  
  geom_signif(data = compareE,
              y_position = 0.95, xmin = 0.8, xmax = 1.2,
              tip_length = 0,
              annotation = c("< 0.001")) +
  geom_signif(data = compareE,
              y_position = 0.95, xmin = 1.8, xmax = 2.2,
              tip_length = 0,
              annotation = c("< 0.001")) +
  geom_text(data = rcritical_10WSour,
            label = "R-crit", aes(y = 0.7, x = 0.6), size = 3) +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.text = element_text(size = 12), # facet text size
        axis.text = element_text(size = 10), # axis text size
        axis.title.y = element_text(size = 12),
        axis.title.x=element_blank(),
        strip.background.y = element_blank(),
        strip.text.y = element_blank()) +
  geom_vline(xintercept = 1.5) +
  coord_cartesian(ylim = c(.5, 1)) 
```
```{r study2ClosedWaterRViz, echo=FALSE, warning=FALSE}
#| fig.cap = "R Index of paired comparison between skim milk and water at an 8% addition level and 17% addition level in a nose closed condition. Dashed horizontal line represents the critical value, which denotes statistical significance, or discrimination between the samples on sourness. Grey bars are not significant (p > 0.05). Red bars indicate the water sample ('Signal') was significant; White bars indicate the milk sample ('Noise') was significant (p < 0.05)."
study2closedWaterRViz
```

- no discrimination seen between the sourness of skim milk or whole milk at either level (p > 0.05, see Figure \@ref(fig:study2ClosedWaterRViz))  
- milk, even at the 8% addition level, was able to be discriminated against the same amount of water added to the cold brew coffee (see Figure \@ref(fig:study2ClosedWaterRViz))
- *01142025*: this could be from detecting pH or TA changes when the milk is added to coffee (Nancy)

### Ratings  
The paired comparison will only show which sample is more sour (or discriminated against), without showing a magnitude of the difference. Thus, sourness intensity ratings were recorded as well. They will be analyzed by paired t-test with a Bonferroni correction against multiple comparisons.  

```{r study2closed ratings wrangling, include=FALSE}
brew10closedsour_ratings <- brew10closedsour %>% select(participant, starts_with("sourness"))

brew10closedsour_ratings_long <- brew10closedsour_ratings %>% 
  pivot_longer(-participant, names_to = "Sample", values_to = "Intensity")

sample_order <- c("sourness_13", "sourness_15", "sourness_14", "sourness_17", "sourness_16", "sourness_18", "sourness_19", "sourness_21", "sourness_20", "sourness_23", "sourness_22", "sourness_24")
```

```{r study2KableClosedRatings, echo=FALSE}
kable(summarySE(brew10closedsour_ratings_long, measurevar = "Intensity", groupvars = "Sample") %>% select(Sample, Intensity, se) %>%  arrange(factor(Sample, levels = sample_order)),
      caption = "sourness intensities and standard error of cold brew coffee samples. Each 2 rows represent the two samples presented in a paired comparison format.")
# may want to learn how to create tables in LaTeX
```

```{r study2notes, include=FALSE, eval=FALSE}
0.05/3 #Bonferroni corrected p
# use $statistic to print t-value
# use $p.value to print p value
```

The Bonferroni corrected $\alpha$ would be `r round(0.05/3, 4)`.

```{r study2closed t-test, collapse=TRUE, comment=""}
t.test(brew10closedsour$sourness_19, brew10closedsour$sourness_21, 
       paired = TRUE, alternative = "two.sided") 
t.test(brew10closedsour$sourness_23, brew10closedsour$sourness_20, 
paired = TRUE, alternative = "greater") #*
t.test(brew10closedsour$sourness_24, brew10closedsour$sourness_22, 
       paired = TRUE, alternative = "greater") #NS w/ Bonferroni

t.test(brew10closedsour$sourness_13, brew10closedsour$sourness_15, 
       paired = TRUE, alternative = "two.sided")
t.test(brew10closedsour$sourness_17, brew10closedsour$sourness_14, 
paired = TRUE, alternative = "greater") #*
t.test(brew10closedsour$sourness_18, brew10closedsour$sourness_16, 
paired = TRUE, alternative = "greater") #*
```

- Ratings between the 8% skim milk and 8% whole milk were NSD (t = `r round(t.test(brew10closedsour$sourness_19, brew10closedsour$sourness_21, paired = TRUE, alternative = "two.sided")$statistic, 3)`, p = `r round(t.test(brew10closedsour$sourness_19, brew10closedsour$sourness_21, paired = TRUE, alternative = "two.sided")$p.value, 3)`)    
- Ratings between the 8% skim milk and 8% water were significantly different (t = `r round(t.test(brew10closedsour$sourness_23, brew10closedsour$sourness_20, paired = TRUE, alternative = "greater")$statistic, 3)`, p = **`r signif(t.test(brew10closedsour$sourness_23, brew10closedsour$sourness_20, paired = TRUE, alternative = "greater")$p.value,2)`**)  
- Ratings between the 8% whole milk and 8% water were NSD (t = `r round(t.test(brew10closedsour$sourness_24, brew10closedsour$sourness_22, paired = TRUE, alternative = "greater")$statistic, 3)`, p = `r round(t.test(brew10closedsour$sourness_24, brew10closedsour$sourness_22, paired = TRUE, alternative = "greater")$p.value,2)`)  

-  Ratings between the 17% skim milk and 17% whole milk were NSD (t = `r round(t.test(brew10closedsour$sourness_13, brew10closedsour$sourness_15, paired = TRUE, alternative = "two.sided")$statistic, 3)`, p = `r round(t.test(brew10closedsour$sourness_13, brew10closedsour$sourness_15, paired = TRUE, alternative = "two.sided")$p.value,2)`)  
- Ratings between the 17% skim milk and 8% water were significantly different (t = `r round(t.test(brew10closedsour$sourness_17, brew10closedsour$sourness_14, paired = TRUE, alternative = "greater")$statistic, 3)`, p = **`r signif(t.test(brew10closedsour$sourness_17, brew10closedsour$sourness_14, paired = TRUE, alternative = "greater")$p.value,2)`**)  
- Ratings between the 17% whole milk and 8% water were significantly different (t = `r round(t.test(brew10closedsour$sourness_18, brew10closedsour$sourness_16, paired = TRUE, alternative = "greater")$statistic, 3)`, p = **`r signif(t.test(brew10closedsour$sourness_18, brew10closedsour$sourness_16, paired = TRUE, alternative = "greater")$p.value,2)`**) 

```{r study2closed viz wrangling, include=FALSE}
brew10closedsour_ratings_long2 <- brew10closedsour_ratings_long
length(brew10closedsour$participant) # 29
length(brew10closedsour_ratings_long2$participant) # 348
brew10closedsour_ratings_long2$condition <- rep("Closed", 348)
brew10closedsour_ratings_long2$addition <- rep(c("Skim", "Whole", "Skim", "Water", "Whole", "Water"), 58) 
brew10closedsour_ratings_long2$percent <- rep(c(rep("17% Addition", 6), rep("8% Addition", 6)), 29)
brew10closedsour_ratings_long2$sample2 <- brew10closedsour_ratings_long2$Sample

brew10closedsour_ratings_trim <- brew10closedsour_ratings_long2 %>% 
  mutate(Sample = recode(Sample, "sourness_13" = "S13")) %>% 
  mutate(Sample = recode(Sample, "sourness_15" = "S15")) %>% 
  mutate(Sample = recode(Sample, "sourness_14" =  "S14")) %>% 
  mutate(Sample = recode(Sample, "sourness_17" =  "S17")) %>% 
  mutate(Sample = recode(Sample, "sourness_16" =  "S16")) %>% 
  mutate(Sample = recode(Sample, "sourness_18" =  "S18")) %>% 
  mutate(Sample = recode(Sample, "sourness_19" = "S13")) %>% 
  mutate(Sample = recode(Sample, "sourness_21" = "S15")) %>% 
  mutate(Sample = recode(Sample, "sourness_20" =  "S14")) %>% 
  mutate(Sample = recode(Sample, "sourness_23" =  "S17")) %>% 
  mutate(Sample = recode(Sample, "sourness_22" =  "S16")) %>% 
  mutate(Sample = recode(Sample, "sourness_24" =  "S18"))


SE_sour <- summarySE(brew10closedsour_ratings_long, measurevar = "Intensity", groupvars = "Sample") %>% 
  select(Sample, Intensity, se) %>% 
  mutate(Sample = recode(Sample, "sourness_13" = "S13")) %>% 
  mutate(Sample = recode(Sample, "sourness_15" = "S15")) %>% 
  mutate(Sample = recode(Sample, "sourness_14" =  "S14")) %>% 
  mutate(Sample = recode(Sample, "sourness_17" =  "S17")) %>% 
  mutate(Sample = recode(Sample, "sourness_16" =  "S16")) %>% 
  mutate(Sample = recode(Sample, "sourness_18" =  "S18")) %>% 
  mutate(Sample = recode(Sample, "sourness_19" = "S13")) %>% 
  mutate(Sample = recode(Sample, "sourness_21" = "S15")) %>% 
  mutate(Sample = recode(Sample, "sourness_20" =  "S14")) %>% 
  mutate(Sample = recode(Sample, "sourness_23" =  "S17")) %>% 
  mutate(Sample = recode(Sample, "sourness_22" =  "S16")) %>% 
  mutate(Sample = recode(Sample, "sourness_24" =  "S18"))
  
SE_sour$percent <- c(rep("17% Addition", 6), rep("8% Addition", 6))

kable(SE_sour %>% arrange(percent, factor(Sample, levels = c("S13", "S15", "S14", "S17", "S16", "S18"))) %>% relocate(percent))

 compareF <- brew10closedsour_ratings_trim %>% filter(percent == "17% Addition" & sample2 %in% c("sourness_16", "sourness_18"))
compareG <- brew10closedsour_ratings_trim %>% filter(percent == "17% Addition" & sample2 %in% c("sourness_14", "sourness_17"))
#compareH <- brew10closedsour_ratings_trim %>% filter(percent == "8% Addition" & sample2 %in% c("sourness_24", "sourness_22"))
# not sig w/ bonferroni

compareI <- brew10closedsour_ratings_trim %>% filter(percent == "8% Addition" & sample2 %in% c("sourness_23", "sourness_20")) 


```

```{r study2ClosedMilkRatings, echo=FALSE}
study2closedMilkRatings <- brew10closedsour_ratings_trim %>% 
  filter(Sample %in% c("S13", "S15")) %>% 
  ggplot(aes(x = factor(Sample, levels = c("S13", "S15")), y = Intensity)) +
  geom_violin(linewidth = 0.5, color = "#555555")+
  facet_grid(condition ~factor(percent, levels = c("8% Addition", "17% Addition"))) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.08)), limits = c(0,10.3)) +
  stat_summary(fun = mean, geom = "point", shape = 19, size = 2, color = "black") +
  geom_errorbar(data = SE_sour %>% filter(Sample %in% c("S13", "S15")), aes(ymin = Intensity-se, ymax = Intensity+se), width = 0.2) +
  theme_bw() +
  theme(panel.grid.major = element_blank(), # remove grid lines
        panel.grid.minor = element_blank(),
        axis.title.x=element_blank(), # remove x title
        strip.text = element_text(size = 12), # facet text size
        axis.text = element_text(size = 12), # axis text size
        axis.title.y = element_text(size = 12), # y axis title size
        strip.background.y = element_blank(), #remove condition facet
        strip.text.y = element_blank()) + # remove Condition facet 
  scale_x_discrete(labels = c("Skim", "Whole", "Whole", "Whole")) +
  labs(y = "Sourness Intensity")
```

```{r study2ClosedMilkRatingsViz, echo=FALSE, warning=FALSE, message=FALSE}
#| fig.cap = "R Index of paired comparison between skim milk and whole milk at an 8% addition level and 17% addition level in a nose closed condition. Dashed horizontal line represents the critical value, which denotes statistical significance, or discrimination between the samples on sourness. Grey bars are not significant (p > 0.05). Red bars indicate the water sample ('Signal') was significant; White bars indicate the milk sample ('Noise') was significant (p < 0.05). sourness intensity ratings (from 0 - 10) are represented as violin plots showing the distribution of scaling responses. Means are presented as black dots with standard error bars."
plot_grid(study2closedMilkRViz, study2closedMilkRatings + theme(strip.background.x = element_blank(), 
        strip.text.x = element_blank()), ncol = 1)
#may want to match the milk rindex viz to the ratings viz for consistency
```

```{r study2closedWaterRatings, echo=FALSE}
study2closedWaterRatings <- brew10closedsour_ratings_trim %>% 
  filter(Sample %in% c("S14", "S17", "S16", "S18")) %>% 
  ggplot(aes(x = factor(Sample, levels = c("S14", "S17", "S16", "S18")), y = Intensity)) +
  geom_violin(linewidth = 0.5, color = "#555555")+
  facet_grid(condition ~factor(percent, levels = c("8% Addition", "17% Addition"))) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.08)), limits = c(0,10.3)) +
  stat_summary(fun = mean, geom = "point", shape = 19, size = 2, color = "black") +
  geom_errorbar(data = SE_sour %>% filter(Sample %in% c("S14", "S17", "S16", "S18")), aes(ymin = Intensity-se, ymax = Intensity+se), width = 0.2) +
  geom_signif(data = compareF, y_position = 10.1 , xmin = 3, xmax = 4, tip_length = 0, annotation = c("< 0.001")) + # 16 v 18
  geom_signif(data = compareG, y_position = 10.1, xmin = 1, xmax = 2, tip_length = 0, annotation = c("< 0.001")) +
#  geom_signif(data = compareH, y_position = 10.1 , xmin = 1, xmax = 2, tip_length = 0, annotation = c("< 0.001")) + 
  geom_signif(data = compareI, # 23 v 20
              y_position = 10.1, xmin = 1, xmax = 2,
              tip_length = 0,
              annotation = c("< 0.001")) +
  theme_bw() +
  theme(panel.grid.major = element_blank(), # remove grid lines
        panel.grid.minor = element_blank(),
        axis.title.x=element_blank(), # remove x title
        strip.text = element_text(size = 12), # facet text size
        axis.text = element_text(size = 12), # axis text size
        axis.title.y = element_text(size = 12), # y axis title size
        strip.background.y = element_blank(), #remove condition facet
        strip.text.y = element_blank()) + # remove Condition facet 
  geom_vline(xintercept = 2.5) +
  scale_x_discrete(labels = c("Skim", "Water", "Whole", "Water")) +
  labs(y = "Sourness Intensity")
```

```{r study2ClosedWaterRatingsViz, echo=FALSE, warning=FALSE, message=FALSE}
#| fig.cap = "R Index of paired comparison between skim milk and water at an 8% addition level and 17% addition level in a nose closed condition. Dashed horizontal line represents the critical value, which denotes statistical significance, or discrimination between the samples on sourness. Grey bars are not significant (p > 0.05). Red bars indicate the water sample ('Signal') was significant; White bars indicate the milk sample ('Noise') was significant (p < 0.05). sourness intensity ratings (from 0 - 10) are represented as violin plots showing the distribution of scaling responses. Means are presented as black dots with standard error bars."
plot_grid(study2closedWaterRViz, study2closedWaterRatings + theme(strip.background.x = element_blank(), 
        strip.text.x = element_blank()), ncol = 1)
# unconvinced of removing facet labels on ratings viz
```

- no discrimination of sourness between comparisons of skim milk and whole milk (see Figure \@ref(fig:study2ClosedMilkRatingsViz))  
- discrimination seen between when water and milk was added to the cold brew (see Figure \@ref(fig:study2ClosedWaterRatingsViz))

## Nose Open Condition
### Participant Data 
```{r study1Meta}
Study1MetaOpen <- read_xlsx(path = "Objective1CompiledDataWithIndex.xlsx", sheet = 13) %>% clean_names()
colnames(Study1MetaOpen)

Study1MetaOpen %>% filter(consumption == "6") 
# 1 - daily; 2 - 2-3/wk; 3- 1/wk
# 4 - 2-3/mo; 5 - 1/mo; 6 <1/mo
```

```{r}
describe(Study1MetaOpen)[2,] %>% select(mean, sd, median, min, max) #age

Study1MetaOpen %>% count(gender) # 10 males, 24 females

Study1MetaOpen %>% group_by(sweetener, whitener) %>% 
  tally() %>% 
  spread(whitener, n) %>% 
  replace(is.na(.), 0)
# 11 - whiten and sweeten
# 12 - whiten, no sweeten
# 21 - sweeten, no whiten
# 22 - black coffee drinker

Study1MetaOpen %>% count(consumption)
# 1 - daily; 2 - 2-3/wk; 3- 1/wk
# 4 - 2-3/mo; 5 - 1/mo; 6 <1/mo
```

```{r study2open data wrangling, include=FALSE, warning=FALSE, message=FALSE}
brew10openedSour <- read_xlsx(path = "Objective1CompiledDataWithIndex.xlsx", sheet = 12)

df10openedSour <- t(brew10openedSour) %>% as.data.frame() %>% row_to_names(row_number = 1) %>% clean_names()
chars <- sapply(df10openedSour, is.character)
df10openedSour[ ,chars] <- as.data.frame(apply(df10openedSour[,chars],2, as.numeric))

df10openedSour <- df10openedSour %>% rownames_to_column(var = "participant")
```

### R Index
The R critical value for a 2-tailed test (milk comparisons) is: **`r Rcriti(length(df10openedSour$participant), length(df10openedSour$participant), 0.05, 2)[2]`**.  

```{r study2opened rindex milks, echo=FALSE, include=FALSE}
Rcriti(length(df10openedSour$participant), length(df10openedSour$participant), 0.05, 2)
```
```{r study2opened 8% milk, include=FALSE}
df10openedSour %>% select(comparison_19_v_21_more_sour, confidence) %>% count(comparison_19_v_21_more_sour, confidence)
Milk10S8OSour <- RIndex(12,8,2,3,4,5,length(df10openedSour$participant)) 
Rcriti(length(df10openedSour$participant), length(df10openedSour$participant), 0.01, 2)
```

- discrimination seen between when 8% skim milk and 8% whole milk was added to coffee (R Index = `r round(as.numeric(Milk10S8OSour)[1], 2)`, p < **0.01**)  
    + interestingly, the skim milk sample (the "noise") was chosen more frequently than the whole milk sample (the "signal"): `r as.numeric(df10openedSour %>% count(comparison_19_v_21_more_sour) %>% select(n) %>% slice(1L))`/`r length(df10openedSour$participant)`

```{r study2opened 17% milk, include=FALSE}
df10openedSour %>% select(comparison_13_v_15_more_sour, confidence_15) %>% count(comparison_13_v_15_more_sour, confidence_15)
Milk10S17OSour <- RIndex(11,3,2,2,6,10,length(df10openedSour$participant))
```

- no discrimination seen between when 17% skim milk and 17% whole milk was added to coffee (R Index = `r round(as.numeric(Milk10S17OSour)[1], 2)`, p > 0.05)  

```{r study2opened r wrangling milk, include=FALSE, echo=FALSE}
Milk10ROpenSour <- tibble(
  Sample = "sample",
  Percent = factor(c("8% Addition", "17% Addition"),
                   levels = c("8% Addition", "17% Addition")),
  Condition = "Opened",
  Rindex = c(as.numeric(v2d(Milk10S8OSour, along = 1)$V1), as.numeric(v2d(Milk10S17OSour, along = 1)$V1)),
  Critical = as.numeric(Rcriti(length(brew10closedsour$participant), length(brew10closedsour$participant), 0.05, 2)[2]),
  S.N = c((v2d(Milk10S8OSour, along = 1)$V2), (v2d(Milk10S17OSour, along = 1)$V2)),
  Sig = ifelse(Rindex > Critical & S.N == "Signal", "#B22222",
               ifelse(Rindex > Critical & S.N == "Noise", "white",
                      "#888888"))
  )

rcritical_10SourOpen <- Milk10ROpenSour %>% filter(Percent == "8% Addition")

compareJ <- Milk10ROpenSour %>% filter(Sig == "white")

study2OpenMilkRViz <- Milk10ROpenSour %>% 
  ggplot(aes(x = Sample, y = Rindex)) +
  geom_col(width = 0.5, fill = Milk10ROpenSour$Sig, color = "black") +
  facet_grid(~Percent) +
  scale_y_continuous(expand = expansion(mult = c(0, .1)), labels = scales::percent) +
  scale_x_discrete(labels = c("Skim/Whole", "Skim/Whole")) +
  geom_hline(aes(yintercept = Critical), linetype = "longdash") +
  theme_bw() +
  geom_signif(data = compareJ,
              y_position = 0.95, xmin = 0.8, xmax = 1.2,
              tip_length = 0,
              annotation = c("< 0.001")) +
  labs(y = "R Index", x = "Sample") +
  geom_text(data = rcritical_10SourOpen,
            label = "R-crit", aes(y = 0.7, x = 0.6), size = 3) +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.text = element_text(size = 12), # facet text size
        axis.text = element_text(size = 10), # axis text size
        axis.title.y = element_text(size = 12),
        axis.title.x=element_blank(),
        strip.background.y = element_blank(),
        strip.text.y = element_blank()) +
  coord_cartesian(ylim = c(.5, 1)) 
```
```{r study2OpenMilkRViz, echo=FALSE, warning=FALSE, message=FALSE}
#| fig.cap = "R Index of paired comparison between skim milk and whole milk at an 8% addition level and 17% addition level in a nose open condition. Dashed horizontal line represents the critical value, which denotes statistical significance, or discrimination between the samples on sourness. Grey bars are not significant (p > 0.05). Red bars indicate the water sample ('Signal') was significant; White bars indicate the milk sample ('Noise') was significant (p < 0.05)."
study2OpenMilkRViz
```

For the paired comparisons between milk and water, we hypothesized that the addition of milk would reduce the sourness, therefore making the water sample the more sour. The critical value for a one tailed R-index calculation is **`r Rcriti(length(df10openedSour$participant), length(df10openedSour$participant), 0.05, 1)[2]`**.  

```{r study2opened rindex water, echo=FALSE, include=FALSE}
Rcriti(length(df10openedSour$participant), length(df10openedSour$participant), 0.05, 1)
```

```{r study2opened 8% water, include=FALSE}
df10openedSour %>% select(comparison_20_v_23_more_sour, confidence_23) %>% count(comparison_20_v_23_more_sour, confidence_23)
water10S8OSour <- RIndex(3,7,1,1,3,19,length(df10openedSour$participant))
Rcriti(length(df10openedSour$participant), length(df10openedSour$participant), 0.001, 1)


df10openedSour %>% select(comparison_22_v_24_more_sour, confidence_24) %>% count(comparison_22_v_24_more_sour, confidence_24)
water10W8OSour <- RIndex(4,4,2,1,7,16,length(df10openedSour$participant))
Rcriti(length(df10openedSour$participant), length(df10openedSour$participant), 0.001, 1)
```

- discrimination seen between when 8% skim milk and 8% water was added to coffee (R Index = `r round(as.numeric(water10S8OSour)[1], 2)`, p $\le$ **0.001**)  
- discrimination seen between when 8% whole milk and 8% water was added to coffee (R Index = `r signif(as.numeric(water10W8OSour)[1], 3)`, p $\le$ **0.001**)   

```{r study2opened 17 water, include=FALSE}
df10openedSour %>% select(comparison_14_v_17_more_sour, confidence_17) %>% count(comparison_14_v_17_more_sour, confidence_17)
water10S17OSour <- RIndex(6,3,1,0,5,19,length(df10openedSour$participant))
Rcriti(length(df10openedSour$participant), length(df10openedSour$participant), 0.001, 1)

df10openedSour %>% select(comparison_16_v_18_more_sour, confidence_18) %>% count(comparison_16_v_18_more_sour, confidence_18)
water10W17OSour <- RIndex(4,2,1,1,6,20,length(df10openedSour$participant))
Rcriti(length(df10openedSour$participant), length(df10openedSour$participant), 0.001, 1)
```

- discrimination between the 17% skim milk and 17% water samples (R Index = `r round(as.numeric(water10S17OSour)[1], 2)`, p $\le$ **0.001**)  
- discrimination seen between the 17% whole milk and 17% water samples (R Index = `r round(as.numeric(water10W17OSour)[1], 2)`, p $\le$ **0.001**)  

```{r study2opened r wrangling water, include=FALSE, warning=FALSE, message=FALSE}
Water10ROpenedSour <- tibble(
  Sample = factor(c(rep(c("S17", "S18"),2))),
  Percent = factor(c(rep("8% Addition",2), rep("17% Addition",2)),
                   levels = c("8% Addition", "17% Addition")),
  Condition = "Opened",  
  Rindex = c(as.numeric(v2d(water10S8OSour, along = 1)$V1),
             as.numeric(v2d(water10W8OSour, along = 1)$V1),
             as.numeric(v2d(water10S17OSour, along = 1)$V1),
             as.numeric(v2d(water10W17OSour, along = 1)$V1)),
  S.N = c((v2d(water10S8OSour, along = 1)$V2),
             (v2d(water10W8OSour, along = 1)$V2),
             (v2d(water10S17OSour, along = 1)$V2),
             (v2d(water10W17OSour, along = 1)$V2)),
  Critical = as.numeric(Rcriti(length(df10openedSour$participant), length(df10openedSour$participant), 0.05, 1)[2]),
  Sig = ifelse(Rindex > Critical & S.N == "Signal", "#B22222",
               ifelse(Rindex > Critical & S.N == "Noise", "white",
                      "#888888"))
  )

compareK <- Water10ROpenedSour %>% 
  filter(Sig %in% "#B22222")

rcritical_10WOpenedSour <- Water10ROpenedSour %>% filter(Percent == "8% Addition")

study2openedWaterRViz <- Water10ROpenedSour %>% 
  ggplot(aes(x = Sample, y = Rindex)) +
  geom_col(width = 0.5, fill = Water10ROpenedSour$Sig, color = "black") +
  facet_grid(~factor(Percent, levels = c("8% Addition", "17% Addition"))) +
  scale_y_continuous(expand = expansion(mult = c(0, .1)), labels = scales::percent) +
  geom_hline(aes(yintercept = Critical), linetype = "longdash") +
  theme_bw() +
  labs(y = "R Index", x = "Sample") +
  scale_x_discrete(labels = c("Skim/Water", "Whole/Water", "Skim/Water", "Whole/Water")) +  
  geom_signif(data = compareK,
              y_position = 0.95, xmin = 1.8, xmax = 2.2,
              tip_length = 0,
              annotation = c("< 0.001")) +
  geom_signif(data = compareK,
              y_position = 0.95, xmin = 0.8, xmax = 1.2,
              tip_length = 0,
              annotation = c("< 0.001")) +
  geom_text(data = rcritical_10WOpenedSour,
            label = "R-crit", aes(y = 0.7, x = 0.6), size = 3) +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.text = element_text(size = 12), # facet text size
        axis.text = element_text(size = 10), # axis text size
        axis.title.y = element_text(size = 12),
        axis.title.x=element_blank(),
        strip.background.y = element_blank(),
        strip.text.y = element_blank()) +
  geom_vline(xintercept = 1.5) +
  coord_cartesian(ylim = c(.5, 1)) 
```
```{r study2OpenedWaterRViz, echo=FALSE, warning=FALSE}
#| fig.cap = "R Index of paired comparison between skim milk and water at an 8% addition level and 17% addition level in a nose opened condition. Dashed horizontal line represents the critical value, which denotes statistical significance, or discrimination between the samples on sourness. Grey bars are not significant (p > 0.05). Red bars indicate the water sample ('Signal') was significant; White bars indicate the milk sample ('Noise') was significant (p < 0.05)."
study2openedWaterRViz
# Warning: see study1OpenedWaterRViz
```

- In the nose open condition, all samples were discriminated against the water sample.  

### Ratings  
```{r study2opened ratings wrangling, include=FALSE}
df10openedSour_ratings <- df10openedSour %>% select(participant, starts_with("sourness"))

df10openedSour_ratings_long <- df10openedSour_ratings %>% 
  pivot_longer(-participant, names_to = "Sample", values_to = "Intensity")

sample_order10S <- c("sourness_13", "sourness_15", "sourness_14", "sourness_17", "sourness_16", "sourness_18", "sourness_19", "sourness_21", "sourness_20", "sourness_23", "sourness_22", "sourness_24")
```

```{r study2KableOpenRatings, echo=FALSE}
kable(summarySE(df10openedSour_ratings_long, measurevar = "Intensity", groupvars = "Sample") %>% select(Sample, Intensity, se) %>%  arrange(factor(Sample, levels = sample_order)),
      caption = "sourness intensities and standard error of cold brew coffee samples evaluated in nose opened condition. Each 2 rows represent the two samples presented in a paired comparison format.")
```

The Bonferroni corrected $\alpha$ would be **`r round(0.05/3, 4)`**.

```{r study2opened t-test, collapse = TRUE, comment=""}
t.test(df10openedSour$sourness_19, df10openedSour$sourness_21, 
       paired = TRUE, alternative = "two.sided") 
t.test(df10openedSour$sourness_23, df10openedSour$sourness_20, 
paired = TRUE, alternative = "greater") #*
t.test(df10openedSour$sourness_24, df10openedSour$sourness_22, 
paired = TRUE, alternative = "greater") #*

t.test(df10openedSour$sourness_13, df10openedSour$sourness_15, 
       paired = TRUE, alternative = "two.sided")
t.test(df10openedSour$sourness_17, df10openedSour$sourness_14, 
paired = TRUE, alternative = "greater") #*
t.test(df10openedSour$sourness_18, df10openedSour$sourness_16, 
paired = TRUE, alternative = "greater") #*
```

- NSD between 8% skim and whole milk (t = `r round(t.test(df10openedSour$sourness_19, df10openedSour$sourness_21, paired = TRUE, alternative = "two.sided")$statistic, 2)`, p = `r round(t.test(df10openedSour$sourness_19, df10openedSour$sourness_21, paired = TRUE, alternative = "two.sided")$p.value,2)`)
- significant reduction in sourness between 8% skim and 8% water ratings (t = `r round(t.test(df10openedSour$sourness_23, df10openedSour$sourness_21, paired = TRUE, alternative = "greater")$statistic,2)`, p = **`r signif(t.test(df10openedSour$sourness_23, df10openedSour$sourness_20, paired = TRUE, alternative = "greater")$p.value,2)`**)  
- significant reduction between 8% whole milk and 8% water ratings (t = `r round(t.test(df10openedSour$sourness_24, df10openedSour$sourness_22, paired = TRUE, alternative = "greater")$statistic,2)`, p = **`r signif(t.test(df10openedSour$sourness_24, df10openedSour$sourness_22, paired = TRUE, alternative = "greater")$p.value, 2)`**)  

- NSD between 17% skim and 17% whole milk ratings (t = `r round(t.test(df10openedSour$sourness_13, df10openedSour$sourness_15, paired = TRUE, alternative = "two.sided")$statistic,2)`, p = `r signif(t.test(df10openedSour$sourness_13, df10openedSour$sourness_15, paired = TRUE, alternative = "two.sided")$p.value,2)`)  
- significant reduction in sourness between 17% skim and 17% water ratings (t = `r round(t.test(df10openedSour$sourness_17, df10openedSour$sourness_14, paired = TRUE, alternative = "greater")$statistic,2)`, p = **`r signif(t.test(df10openedSour$sourness_17, df10openedSour$sourness_14, paired = TRUE, alternative = "greater")$p.value,2)`**)  
- significant reduction between 17% whole milk and 17% water ratings (t = `r round(t.test(df10openedSour$sourness_18, df10openedSour$sourness_16, paired = TRUE, alternative = "greater")$statistic,2)`, p = **`r signif(t.test(df10openedSour$sourness_18, df10openedSour$sourness_16, paired = TRUE, alternative = "greater")$p.value,2)`**)  

```{r study2opened viz wrangling, include=FALSE}
df10openedSour_ratings_long2 <- df10openedSour_ratings_long
length(df10openedSour$participant) # 34
length(df10openedSour_ratings_long2$participant) # 408
df10openedSour_ratings_long2$condition <- rep("opened", 408)
df10openedSour_ratings_long2$addition <- rep(c("Skim", "Whole", "Skim", "Water", "Whole", "Water"), 68) 
df10openedSour_ratings_long2$percent <- rep(c(rep("17% Addition", 6), rep("8% Addition", 6)), 34)
df10openedSour_ratings_long2$sample2 <- df10openedSour_ratings_long2$Sample

df10openedSour_ratings_trim <- df10openedSour_ratings_long2 %>% 
  mutate(Sample = recode(Sample, "sourness_13" = "S13")) %>% 
  mutate(Sample = recode(Sample, "sourness_15" = "S15")) %>% 
  mutate(Sample = recode(Sample, "sourness_14" =  "S14")) %>% 
  mutate(Sample = recode(Sample, "sourness_17" =  "S17")) %>% 
  mutate(Sample = recode(Sample, "sourness_16" =  "S16")) %>% 
  mutate(Sample = recode(Sample, "sourness_18" =  "S18")) %>% 
  mutate(Sample = recode(Sample, "sourness_19" = "S13")) %>% 
  mutate(Sample = recode(Sample, "sourness_21" = "S15")) %>% 
  mutate(Sample = recode(Sample, "sourness_20" =  "S14")) %>% 
  mutate(Sample = recode(Sample, "sourness_23" =  "S17")) %>% 
  mutate(Sample = recode(Sample, "sourness_22" =  "S16")) %>% 
  mutate(Sample = recode(Sample, "sourness_24" =  "S18"))


SE_sour_opened <- summarySE(df10openedSour_ratings_long, measurevar = "Intensity", groupvars = "Sample") %>% 
  select(Sample, Intensity, se) %>% 
  mutate(Sample = recode(Sample, "sourness_13" = "S13")) %>% 
  mutate(Sample = recode(Sample, "sourness_15" = "S15")) %>% 
  mutate(Sample = recode(Sample, "sourness_14" =  "S14")) %>% 
  mutate(Sample = recode(Sample, "sourness_17" =  "S17")) %>% 
  mutate(Sample = recode(Sample, "sourness_16" =  "S16")) %>% 
  mutate(Sample = recode(Sample, "sourness_18" =  "S18")) %>% 
  mutate(Sample = recode(Sample, "sourness_19" = "S13")) %>% 
  mutate(Sample = recode(Sample, "sourness_21" = "S15")) %>% 
  mutate(Sample = recode(Sample, "sourness_20" =  "S14")) %>% 
  mutate(Sample = recode(Sample, "sourness_23" =  "S17")) %>% 
  mutate(Sample = recode(Sample, "sourness_22" =  "S16")) %>% 
  mutate(Sample = recode(Sample, "sourness_24" =  "S18"))
  
SE_sour_opened$percent <- c(rep("17% Addition", 6), rep("8% Addition", 6))

kable(SE_sour_opened %>% arrange(percent, factor(Sample, levels = c("S13", "S15", "S14", "S17", "S16", "S18"))) %>% relocate(percent))

#compareL <- df10openedSour_ratings_trim %>% filter(sample2 %in% c("sourness_19", "sourness_21"))

compareM <- df10openedSour_ratings_trim %>% filter(percent == "17% Addition" & sample2 %in% c("sourness_16", "sourness_18"))
  
compareN <- df10openedSour_ratings_trim %>% filter(percent == "17% Addition" & sample2 %in% c("sourness_14", "sourness_17"))

compareO <- df10openedSour_ratings_trim %>% filter(percent == "8% Addition" & sample2 %in% c("sourness_24", "sourness_22"))

compareP <- df10openedSour_ratings_trim %>% filter(percent == "8% Addition" & sample2 %in% c("sourness_23", "sourness_20"))
```

```{r study2OpenedMilkRatings, echo=FALSE}
study2OpenedMilkRatings <- df10openedSour_ratings_trim %>% 
  filter(Sample %in% c("S13", "S15")) %>% 
  ggplot(aes(x = factor(Sample, levels = c("S13", "S15")), y = Intensity)) +
  geom_violin(linewidth = 0.5, color = "#555555")+
  facet_grid(condition ~factor(percent, levels = c("8% Addition", "17% Addition"))) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.08)), limits = c(0,10.3)) +
  stat_summary(fun = mean, geom = "point", shape = 19, size = 2, color = "black") +
  geom_errorbar(data = SE_sour_opened %>% filter(Sample %in% c("S13", "S15")), aes(ymin = Intensity-se, ymax = Intensity+se), width = 0.2) +
  #geom_signif(data = compareL, y_position = 10.1, xmin = 1, xmax = 2, tip_length = 0, annotation = c("0.06")) +
  theme_bw() +
  theme(panel.grid.major = element_blank(), # remove grid lines
        panel.grid.minor = element_blank(),
        axis.title.x=element_blank(), # remove x title
        strip.text = element_text(size = 12), # facet text size
        axis.text = element_text(size = 12), # axis text size
        axis.title.y = element_text(size = 12), # y axis title size
        strip.background.y = element_blank(), #remove condition facet
        strip.text.y = element_blank()) + # remove Condition facet 
  scale_x_discrete(labels = c("Skim", "Whole", "Whole", "Whole")) +
  labs(y = "sourness Intensity")
```

```{r study2OpenedMilkRatingsViz, echo=FALSE, warning=FALSE, message=FALSE}
#| fig.cap = "R Index of paired comparison between skim milk and whole milk at an 8% addition level and 17% addition level in a nose opened condition. Dashed horizontal line represents the critical value, which denotes statistical significance, or discrimination between the samples on sourness. Grey bars are not significant (p > 0.05). Red bars indicate the water sample ('Signal') was significant; White bars indicate the milk sample ('Noise') was significant (p < 0.05). sourness intensity ratings (from 0 - 10) are represented as violin plots showing the distribution of scaling responses. Means are presented as black dots with standard error bars."
plot_grid(study2OpenMilkRViz, study2OpenedMilkRatings + theme(strip.background.x = element_blank(), 
        strip.text.x = element_blank()), ncol = 1)
```

```{r study2OpenedWaterRatings, echo=FALSE}
study2OpenedWaterRatings <- df10openedSour_ratings_trim %>% 
  filter(Sample %in% c("S14", "S17", "S16", "S18")) %>% 
  ggplot(aes(x = factor(Sample, levels = c("S14", "S17", "S16", "S18")), y = Intensity)) +
  geom_violin(linewidth = 0.5, color = "#555555") +
  facet_grid(condition ~factor(percent, levels = c("8% Addition", "17% Addition"))) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.08)), limits = c(0,10.3)) +
  stat_summary(fun = mean, geom = "point", shape = 19, size = 2, color = "black") +
  geom_errorbar(data = SE_sour_opened %>% filter(Sample %in% c("S14", "S17", "S16", "S18")), aes(ymin = Intensity-se, ymax = Intensity+se), width = 0.2) +
  geom_signif(data = compareM, # 16 v 18
              y_position = 10.1 , xmin = 3, xmax = 4,
              tip_length = 0,
              annotation = c("< 0.001")) + 
  geom_signif(data = compareN, # 14 v 17
              y_position = 10.1, xmin = 1, xmax = 2,
              tip_length = 0,
              annotation = c("0.003")) +
  geom_signif(data = compareO, # 22 v 24
              y_position = 10.1 , xmin = 3, xmax = 4,
              tip_length = 0,
              annotation = c("0.006")) + 
  geom_signif(data = compareP, # 23 v 20
              y_position = 10.1, xmin = 1, xmax = 2,
              tip_length = 0,
              annotation = c("0.008")) +
  theme_bw() +
  theme(panel.grid.major = element_blank(), # remove grid lines
        panel.grid.minor = element_blank(),
        axis.title.x=element_blank(), # remove x title
        strip.text = element_text(size = 12), # facet text size
        axis.text = element_text(size = 12), # axis text size
        axis.title.y = element_text(size = 12), # y axis title size
        strip.background.y = element_blank(), #remove condition facet
        strip.text.y = element_blank()) + # remove Condition facet 
  geom_vline(xintercept = 2.5) +
  scale_x_discrete(labels = c("Skim", "Water", "Whole", "Water")) +
  labs(y = "sourness Intensity")
```

```{r study2OpenedWaterRatingsViZ, echo=FALSE, warning=FALSE, message=FALSE}
#| fig.cap = "R Index of paired comparison between skim milk and water at an 8% addition level and 17% addition level in a nose opened condition. Dashed horizontal line represents the critical value, which denotes statistical significance, or discrimination between the samples on sourness. Grey bars are not significant (p > 0.05). Red bars indicate the water sample ('Signal') was significant; White bars indicate the milk sample ('Noise') was significant (p < 0.05). sourness intensity ratings (from 0 - 10) are represented as violin plots showing the distribution of scaling responses. Means are presented as black dots with standard error bars."
plot_grid(study2openedWaterRViz, study2OpenedWaterRatings + theme(strip.background.x = element_blank(), 
        strip.text.x = element_blank()), ncol = 1)
# unconvinced of removing facet labels on ratings viz
# Warning: see study1OpenedWaterRViz
```

- the p-values between the ratings in the nose opened condition (Figure \@ref(fig:study2OpenedWaterRatingsViZ)) are not necessarily larger than those in the nose closed condition (Figure \@ref(fig:study2ClosedWaterRatingsViz)), suggesting that any cross-modal effects, if present at all, are trivial

## Comparison of Conditions

```{r study2Milk10Combine wrangling, include=FALSE}
Milk10RCombine <- full_join(Milk10RSour, Milk10ROpenSour)

Milk10RCombineViz <- Milk10RCombine %>% 
  ggplot(aes(x = Sample, y = Rindex)) +
  geom_col(width = 0.5, fill = Milk10RCombine$Sig, color = "black") +
  facet_grid(Condition~Percent) +
  scale_y_continuous(expand = expansion(mult = c(0, .1)), labels = scales::percent) +
  scale_x_discrete(labels = c("Skim/Whole", "Skim/Whole")) +
  geom_hline(aes(yintercept = Critical), linetype = "longdash") +
  theme_bw() +
  labs(y = "R Index", x = "Sample") +
  geom_signif(data = compareJ,
              y_position = 0.95, xmin = 0.8, xmax = 1.2,
              tip_length = 0,
              annotation = c("< 0.05")) +
  geom_text(data = rcritical_10SourOpen,
            label = "R-crit", aes(y = 0.7, x = 0.6), size = 3) +
# Note 1-3-25: is this representative of both r-critical values?
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.text = element_text(size = 12), # facet text size
        axis.text = element_text(size = 10), # axis text size
        axis.title.y = element_text(size = 12),
        axis.title.x=element_blank()) +
  coord_cartesian(ylim = c(.5, 1)) 
```
```{r study2MilkCombineRViz, echo=FALSE}
#| fig.cap = "R Index of paired comparison between skim milk and whole milk at an 8% addition level and 17% addition level in a nose closed and nose opened condition. Dashed horizontal line represents the critical value, which denotes statistical significance, or discrimination between the samples on sourness. Grey bars are not significant (p > 0.05). Red bars indicate the water sample (â€˜Signalâ€™) was significant; White bars indicate the milk sample (â€˜Noiseâ€™) was significant (p < 0.05)." 
Milk10RCombineViz
```

```{r study2Water10RCombineViz wrangling, include=FALSE, warning=FALSE}
Water10RCombineSour <- full_join(Water10RSour, Water10ROpenedSour)
Water10RCombineSourViz <- Water10RCombineSour %>% 
  ggplot(aes(x = Sample, y = Rindex)) +
  geom_col(width = 0.5, fill = Water10RCombineSour$Sig, color = "black") +
  facet_grid(Condition~factor(Percent, levels = c("8% Addition", "17% Addition"))) +
  scale_y_continuous(expand = expansion(mult = c(0, .1)), labels = scales::percent) +
  geom_hline(aes(yintercept = Critical), linetype = "longdash") +
  theme_bw() +
  labs(y = "R Index", x = "Sample") +
  scale_x_discrete(labels = c("Skim/Water", "Whole/Water", "Skim/Water", "Whole/Water")) +  
  geom_signif(y_position = 0.95, xmin = 0.8, xmax = 1.2,
              tip_length = 0,
              annotation = c("< 0.001")) +
  geom_signif(y_position = 0.95, xmin = 1.8, xmax = 2.2,
              tip_length = 0,
              annotation = c("< 0.001")) +
  geom_text(data = rcritical_10WOpenedSour,
            label = "R-crit", aes(y = 0.7, x = 0.6), size = 3) +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.text = element_text(size = 12), # facet text size
        axis.text = element_text(size = 10), # axis text size
        axis.title.y = element_text(size = 12),
        axis.title.x=element_blank()) +
  geom_vline(xintercept = 1.5) +
  coord_cartesian(ylim = c(.5, 1))
```
```{r study2WaterCombineRViz, echo=FALSE, warning=FALSE}
#| fig.cap = "R Index of paired comparison between skim milk, whole milk, and water at an 8% addition level and 17% addition level in a nose closed and nose opened condition. Dashed horizontal line represents the critical value, which denotes statistical significance, or discrimination between the samples on sourness. Grey bars are not significant (p > 0.05). Red bars indicate the water sample (â€˜Signalâ€™) was significant; White bars indicate the milk sample (â€˜Noiseâ€™) was significant (p < 0.05)." 
Water10RCombineSourViz
```

- Figure \@ref(fig:study2MilkCombineRViz) shows that in the nose open condition the skim milk could be differentiated from whole milk addition (at 8%) on sourness. But this is not seen at the 17% level.  
- The skim milk sample was perceived as less bitter compared to the water sample (Figure \@ref(fig:study2WaterCombineRViz)).  
  + This is different from what was seen in the [1:10 Bitter](#Bitter10Comp) condition (see Figures \@ref(fig:study1MilkCombineRViz) and \@ref(fig:study1WaterCombineRViz))

## Notes {-}
<input type="checkbox"> examine the participant data  
  - do panelists need to be excluded because they do not meet inclusion criteria?  
<input type="checkbox"> update Rindex figures like Chris described  
<input type="checkbox"> resolve `warnings()`?