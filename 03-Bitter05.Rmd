# 1:5 Bitterness {#Bitter5}

This will be the data analysis and results of the 1:5 nose closed study run in March 2023 and the 1:5 nose open study run in September 2023.  

See the 1:10 brew strength bitter analysis [here](#Bitter10). 

A 1:10 brew strength (coffee:water, w/w) is representative of a strong ratio used by everyday consumers. Our hypotheses was:  

> Milk will reduce the bitterness of cold brew coffee more than water  

This hypothesis is thought to be seen regardless of condition (nose closed or nose open). 

Some interpretations of expected data would be:

- In the nose closed condition a reduction in bitterness from the milky coffee would suggest a physicochemical interaction between the milk and coffee  
- Milk, being 86% water [@walstraDairyTechnologyPrinciples1999] could have a similar effect as water would when added to coffee   
- In the nose opened condition, a reduction in bitterness from the milky coffee could suggest a cross-modal interaction (particularly if no effect is seen in the nose closed condition) 

## Nose Closed Condition
```{r study3library, message=FALSE, warning=FALSE, include=FALSE}
# data wrangling
library(plyr)
library(tidyverse) # data wrangling
library(str2str) # R viz wrangling
library(readxl) # read in data
library(Rmisc) # summarySE()
library(agricolae) #LSD test
library(janitor) #clean_names()
library(tibble)

# correlations
library(Hmisc)

# analysis
library(sensR)

#visualizations
library(ggplot2) # plotting
library(grid) # adjusting axes on plots
library(ggsignif) #add signif to plots
library(cowplot) #combining plots
library(patchwork)
library(gghighlight)
library(knitr)
library(ggpmisc)
library(ggrepel)
```
```{r study3Rcriti, include=FALSE}
# R-index is a non-parametric test related to the Whitney *U* and the Wilcox *W* test.
# It recreates a ROC (receiver operating characteristic) curve based on choice/confidence data.
# The statistic can be interpreted as the proportion of people who chose sample Y over X, *P(X \< Y)*.
# From @biRindexCriticalValue2020

Rcriti<- function(nc, nt, alpha, side) {#R-index critical value in difference testing, i.e.,rc=â€‰100*(Rc-0.5); Rc=0.5+rc/100

#nc, nt are sample sizes of the control sample and the test sample

#alpha is a significance level; side=1 is a one-sided test and side=2 is two-sided test

#See, @biUpdatedExtendedTable2007

if(side==2){

z <- qnorm(1 - alpha/2)}

if(side==1)

{z<-qnorm(1-alpha)}

rcf <- function(Rc, nc, nt, z)

{

q1 <- Rc/(2 - Rc)

q2 <- (2 * Rc^2)/(1 + Rc)

va <- Rc * (1 - Rc) + (nt - 1) * (q1 - Rc^2) + (nc - 1) * (q2 - Rc^2)

va <- va/(nc * nt)

s <- sqrt(va)

(Rc - 0.5)/s - z

}

Rc <- uniroot(rcf, interval = c(0.5, 0.9999), nc = nc, nt = nt, z = z)

Rc <- Rc[[1]]

rc <- 100 * (Rc - 0.5)

rc <- round(rc, 2)

rc

cat("rc and Rc values:","/n")

all<-c(rc,Rc)

all<-round(all,2)

all

}
```
```{r study3RIndex, include=FALSE}
RIndex <- function(a,b,c,d,e,f,n) {
# a = S!, b = S, c = S?
# d = N?, e = N, f = N!, n = sample size
  aa <- a*(a+b+c+d+e)
  bb <- b*(a+b+c+d)
  cc <- c*(a+b+c)
  dd <- d*(a+b)
  ee <- e*a
  prod <- .5*((a*f)+ (b*e)+ (c*d)+ (c*d)+ (b*e)+ (a*f))
  denom <- (n^2)
  
  index<- sum(aa,bb,cc,dd,ee,prod)/denom 
  #formula from [@omahonySensoryEvaluationFood1986]
  
  if (1-index >= 0.5){
    r <- 1-index
    print(c(r, "Signal")) #this says which S/N was > 50%
  } else {
    r <- index
    print(c(r, "Noise")) #this says which S/N was > 50%
  }
}
```

```{r study3closed data wrangling, include=FALSE}
brew5closed <- read_xlsx(path = "Objective1CompiledDataWithIndex.xlsx", sheet = 5) 
# ~/ not necessary when in working directory, just use "filename.xlsx"

df5closed <- t(brew5closed) %>% as.data.frame() %>% row_to_names(row_number = 1) %>% clean_names()
chars <- sapply(df5closed, is.character)
df5closed[ ,chars] <- as.data.frame(apply(df5closed[,chars],2, as.numeric))
# turn data frame from char to numeric

df5closed <- df5closed %>% rownames_to_column(var = "participant")
# create participant column
```

### R Index  
In the paired comparisons between when skim milk or whole milk was added to the coffee, there is not enough evidence to suggest one will reduce the bitterness more than the other [cf. @keastModificationBitternessCaffeine2008].  
The critical value for a 2-tailed test is `r round(Rcriti(length(df5closed$participant), length(df5closed$participant), 0.05, 1)[2],2)`.  
```{r study3closed rindex milks, echo=FALSE, include=FALSE}
Rcriti(length(df5closed$participant), length(df5closed$participant), 0.05, 2)
```
```{r study3closed 8% milk, include=FALSE}
df5closed %>% select(comparison_7_v_9_more_bitter, confidence_9) %>% count(comparison_7_v_9_more_bitter, confidence_9)
Milk5S8C <- RIndex(12,4,2,1,3,10,length(df5closed$participant)) 
```

- no discrimination seen between when 8% skim milk and 8% whole milk was added to coffee (R Index = `r round(as.numeric(Milk5S8C)[1], 2)`, p > 0.05)  

```{r study3closed 17% milk, include=FALSE}
df5closed %>% select(comparison_1_v_3_more_bitter, confidence_3) %>% count(comparison_1_v_3_more_bitter, confidence_3)
Milk5S17C <- RIndex(13,3,0,3,3,10,length(df5closed$participant))
```

- no discrimination between 17% skim milk or 17% whole milk added to coffee, (R Index = `r round(as.numeric(Milk5S17C)[1], 2)`, p > 0.05)  

```{r study3closed r wrangling milk, include=FALSE}
Milk5R <- tibble(
  Sample = "sample",
  Percent = factor(c("8% Addition", "17% Addition"),
                   levels = c("8% Addition", "17% Addition")),
  Condition = "Closed",
  Rindex = c(as.numeric(v2d(Milk5S8C, along = 1)$V1), as.numeric(v2d(Milk5S17C, along = 1)$V1)),
  Critical = as.numeric(Rcriti(length(df5closed$participant), length(df5closed$participant), 0.05, 2)[2]),
  Sig = ifelse(Rindex > Critical, "white", "#888888")
)


rcritical_5 <- Milk5R %>% filter(Percent == "8% Addition")


study3closedMilkRViz <- Milk5R %>% 
  ggplot(aes(x = Sample, y = Rindex)) +
  geom_col(width = 0.5, fill = Milk5R$Sig, color = "black") +
  facet_grid(~Percent) +
  scale_y_continuous(expand = expansion(mult = c(0, .1)), labels = scales::percent) +
  scale_x_discrete(labels = c("Skim/Whole", "Skim/Whole")) +
  geom_hline(aes(yintercept = Critical), linetype = "longdash") +
  theme_bw() +
  labs(y = "R Index", x = "Sample") +
  geom_text(data = rcritical_5,
            label = "R-crit", aes(y = 0.7, x = 0.6), size = 3) +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.text = element_text(size = 12), # facet text size
        axis.text = element_text(size = 10), # axis text size
        axis.title.y = element_text(size = 12),
        axis.title.x=element_blank(),
        strip.background.y = element_blank(),
        strip.text.y = element_blank()) +
  coord_cartesian(ylim = c(.5, 1)) 

```
```{r study3ClosedMilkRViz, echo=FALSE}
#| fig.cap = "R Index of paired comparison between skim milk and whole milk at an 8% addition level and 17% addition level in a nose closed condition. Dashed horizontal line represents the critical value, which denotes statistical significance, or discrimination between the samples on bitterness. Grey bars are not significant (p > 0.05). Red bars indicate the water sample ('Signal') was significant; White bars indicate the milk sample ('Noise') was significant (p < 0.05)."
study3closedMilkRViz
# LaTeX is not supported in figure captions
```

For the paired comparisons between milk and water, we hypothesized that the addition of milk would reduce the bitterness, therefore making the water sample the more bitter. The critical value for a one tailed R-index calculation is `r round(Rcriti(length(df5closed$participant), length(df5closed$participant), 0.05, 1)[2], 2)`.  
```{r study3closed rindex water, echo=FALSE, include=FALSE}
Rcriti(length(df5closed$participant), length(df5closed$participant), 0.05, 1)
```

```{r study3closed 8% water, include=FALSE}
df5closed %>% select(comparison_8_v_11_more_bitter, confidence_11) %>% count(comparison_8_v_11_more_bitter, confidence_11)
water5S8C <- RIndex(12,3,2,5,2,8,length(df5closed$participant))

df5closed %>% select(comparison_10_v_12_more_bitter, confidence_12) %>% count(comparison_10_v_12_more_bitter, confidence_12)
water5W8C <- RIndex(12,3,1,2,4,10,length(df5closed$participant))
```

- no discrimination seen between when 8% skim milk and 8% water was added to coffee (R Index = `r round(as.numeric(water5S8C)[1], 2)`, p > 0.05)  

- no discrimination seen between when 8% whole milk and 8% water was added to coffee (R Index = `r round(as.numeric(water5W8C)[1], 2)`, p > 0.05)   

```{r study3closed 17 water, include=FALSE}
df5closed %>% select(comparison_2_v_5_more_bitter, confidence_5) %>% count(comparison_2_v_5_more_bitter, confidence_5)
water5S17C <- RIndex(7,6,5,1,8,5,length(df5closed$participant))

df5closed %>% select(comparison_4_v_6_more_bitter, confidence_6) %>% count(comparison_4_v_6_more_bitter, confidence_6)
water5W17C <- RIndex(10,3,1,3,3,12,length(df5closed$participant))
```

- no discrimination between the 17% skim milk and 17% water samples (R Index = `r round(as.numeric(water5S17C)[1], 2)`, p > 0.05)  
- no discrimination between the 17% whole milk and 17% water samples (R Index = `r round(as.numeric(water5W17C)[1], 2)`, p > 0.05)  

```{r study3closed r wrangling water, include=FALSE, warning=FALSE, message=FALSE}
Water5R <- tibble(
  Sample = factor(c(rep(c("B5", "B6"),2))),
  Percent = factor(c(rep("8% Addition",2), rep("17% Addition",2)),
                   levels = c("8% Addition", "17% Addition")),
  Condition = "Closed",  
  Rindex = c(as.numeric(v2d(water5S8C, along = 1)$V1),
             as.numeric(v2d(water5W8C, along = 1)$V1),
             as.numeric(v2d(water5S17C, along = 1)$V1),
             as.numeric(v2d(water5W17C, along = 1)$V1)),
  S.N = c((v2d(water5S8C, along = 1)$V2),
             (v2d(water5W8C, along = 1)$V2),
             (v2d(water5S17C, along = 1)$V2),
             (v2d(water5W17C, along = 1)$V2)),
  Critical = as.numeric(Rcriti(length(df5closed$participant), length(df5closed$participant), 0.05, 1)[2]),
  Sig = ifelse(Rindex > Critical & S.N == "Signal", "#B22222",
               ifelse(Rindex > Critical & S.N == "Noise", "white",
                      "#888888"))
  )


rcritical_5W <- Water5R %>% filter(Sample == "B5" & Percent == "8% Addition")


study3closedWaterRViz <- Water5R %>% 
  ggplot(aes(x = Sample, y = Rindex)) +
  geom_col(width = 0.5, fill = Water5R$Sig, color = "black") +
  facet_grid(~Percent) +
  scale_y_continuous(expand = expansion(mult = c(0, .1)), labels = scales::percent) +
  geom_hline(aes(yintercept = Critical), linetype = "longdash") +
  theme_bw() +
  labs(y = "R Index", x = "Sample") +
  scale_x_discrete(labels = c("Skim/Water", "Whole/Water", "Skim/Water", "Whole/Water")) +  
  geom_text(data = rcritical_5W,
            label = "R-crit", aes(y = 0.7, x = 0.6), size = 3) +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.text = element_text(size = 12), # facet text size
        axis.text = element_text(size = 10), # axis text size
        axis.title.y = element_text(size = 12),
        axis.title.x=element_blank(),
        strip.background.y = element_blank(),
        strip.text.y = element_blank()) +
  geom_vline(xintercept = 1.5) +
  coord_cartesian(ylim = c(.5, 1)) 
```
```{r study3ClosedWaterRViz, echo=FALSE, warning=FALSE}
#| fig.cap = "R Index of paired comparison between skim milk and water at an 8% addition level and 17% addition level in a nose closed condition. Dashed horizontal line represents the critical value, which denotes statistical significance, or discrimination between the samples on bitterness. Grey bars are not significant (p > 0.05). Red bars indicate the water sample ('Signal') was significant; White bars indicate the milk sample ('Noise') was significant (p < 0.05)."
study3closedWaterRViz
```

- No discrimination was seen at either the 8% or 17% addition levels  
  + To me, this calls into question Figure (see \@ref(fig:study1ClosedWaterRViz))   

### Ratings  
The paired comparison will only show which sample is more bitter (or discriminated against), without showing a magnitude of the difference. Thus, bitterness intensity ratings were recorded as well. They will be analyzed by paired t-test with a Bonferroni correction against multiple comparisons.  

```{r study3closed ratings wrangling, include=FALSE}
df5closed_ratings <- df5closed %>% select(participant, starts_with("bitterness"))

df5closed_ratings_long <- df5closed_ratings %>% 
  pivot_longer(-participant, names_to = "Sample", values_to = "Intensity")

sample_order5 <- c("bitterness_1", "bitterness_3", "bitterness_2", "bitterness_5", "bitterness_4", "bitterness_6", "bitterness_7", "bitterness_9", "bitterness_8", "bitterness_11", "bitterness_10", "bitterness_12")
```

```{r study3KableClosedRatings, echo=FALSE}
kable(summarySE(df5closed_ratings_long, measurevar = "Intensity", groupvars = "Sample") %>% select(Sample, Intensity, sd, se) %>%  arrange(factor(Sample, levels = sample_order5)),
      caption = "Bitterness intensities, standard deviation, and standard error of cold brew coffee samples. Each 2 rows represent the two samples presented in a paired comparison format.")
# may want to learn how to create tables in LaTeX
```

```{r study3notes, include=FALSE, eval=FALSE}
0.05/6 #Bonferroni corrected p
# use $statistic to print t-value
# use $p.value to print p value
# is the Bonferroni correction0.05/6 (total comparisons) or 0.05/3 (comparisons within a percent block)
```

The Bonferroni corrected $\alpha$ would be `r round(0.05/6, 4)`.

```{r study3closed t-test, collapse=TRUE, comment=""}
t.test(df5closed$bitterness_7, df5closed$bitterness_9, 
       paired = TRUE, alternative = "two.sided") 
t.test(df5closed$bitterness_11, df5closed$bitterness_8, 
       paired = TRUE, alternative = "greater")
t.test(df5closed$bitterness_12, df5closed$bitterness_10, 
       paired = TRUE, alternative = "greater")

t.test(df5closed$bitterness_1, df5closed$bitterness_3, 
       paired = TRUE, alternative = "two.sided")
t.test(df5closed$bitterness_5, df5closed$bitterness_2, 
       paired = TRUE, alternative = "greater")
t.test(df5closed$bitterness_6, df5closed$bitterness_4, 
       paired = TRUE, alternative = "greater")
```


- Marginal reduction in ratings between the 8% skim milk and 8% whole milk (t = `r round(t.test(df5closed$bitterness_7, df5closed$bitterness_9, paired = TRUE, alternative = "two.sided")$statistic, 3)`, p = `r round(t.test(df5closed$bitterness_7, df5closed$bitterness_9, paired = TRUE, alternative = "two.sided")$p.value,2)`) 
- Ratings between the 8% skim milk and 8% water were NSD (t = `r round(t.test(df5closed$bitterness_11, df5closed$bitterness_8, paired = TRUE, alternative = "greater")$statistic, 3)`, p = `r round(t.test(df5closed$bitterness_11, df5closed$bitterness_8, paired = TRUE, alternative = "greater")$p.value,2)`) 
- Ratings between the 8% whole milk and 8% water were NSD (t = `r round(t.test(df5closed$bitterness_12, df5closed$bitterness_10, paired = TRUE, alternative = "greater")$statistic, 3)`, p = `r round(t.test(df5closed$bitterness_12, df5closed$bitterness_10, paired = TRUE, alternative = "greater")$p.value,2)`) 

- 17% milk comparisons were not significantly different in ratings (t = `r round(t.test(df5closed$bitterness_1, df5closed$bitterness_3, paired = TRUE, alternative = "two.sided")$statistic, 3)`, p = `r round(t.test(df5closed$bitterness_1, df5closed$bitterness_3, paired = TRUE, alternative = "two.sided")$p.value,2)`)
- Ratings between the 17% skim milk and 17% water were NSD (t = `r round(t.test(df5closed$bitterness_5, df5closed$bitterness_2, paired = TRUE, alternative = "greater")$statistic, 3)`, p = `r round(t.test(df5closed$bitterness_5, df5closed$bitterness_2, paired = TRUE, alternative = "greater")$p.value,2)`)  
- Ratings between the 17% whole milk and 17% water were NSD (t = `r round(t.test(df5closed$bitterness_6, df5closed$bitterness_4, paired = TRUE, alternative = "greater")$statistic, 3)`, p = `r round(t.test(df5closed$bitterness_6, df5closed$bitterness_4, paired = TRUE, alternative = "greater")$p.value,2)`) 

```{r study3closed viz wrangling, include=FALSE}
df5closed_ratings_long2 <- df5closed_ratings_long
length(df5closed$participant) # 32
length(df5closed_ratings_long2$participant) # 384
df5closed_ratings_long2$condition <- rep("Closed", 384)
df5closed_ratings_long2$addition <- rep(c("Skim", "Whole", "Skim", "Water", "Whole", "Water"), 64) 
df5closed_ratings_long2$percent <- rep(c(rep("17% Addition", 6), rep("8% Addition", 6)), 32)
df5closed_ratings_long2$sample2 <- df5closed_ratings_long2$Sample

df5closed_ratings_trim <- df5closed_ratings_long2 %>% 
  mutate(Sample = recode(Sample, "bitterness_1" = "B1")) %>% 
  mutate(Sample = recode(Sample, "bitterness_3" = "B3")) %>% 
  mutate(Sample = recode(Sample, "bitterness_2" =  "B2")) %>% 
  mutate(Sample = recode(Sample, "bitterness_5" =  "B5")) %>% 
  mutate(Sample = recode(Sample, "bitterness_4" =  "B4")) %>% 
  mutate(Sample = recode(Sample, "bitterness_6" =  "B6")) %>% 
  mutate(Sample = recode(Sample, "bitterness_7" = "B1")) %>% 
  mutate(Sample = recode(Sample, "bitterness_9" = "B3")) %>% 
  mutate(Sample = recode(Sample, "bitterness_8" =  "B2")) %>% 
  mutate(Sample = recode(Sample, "bitterness_11" =  "B5")) %>% 
  mutate(Sample = recode(Sample, "bitterness_10" =  "B4")) %>% 
  mutate(Sample = recode(Sample, "bitterness_12" =  "B6"))


SE_bitter <- summarySE(df5closed_ratings_long, measurevar = "Intensity", groupvars = "Sample") %>% 
  select(Sample, Intensity, se) %>% 
  arrange(factor(Sample, levels = sample_order5)) %>% 
  mutate(Sample = recode(Sample, "bitterness_1" = "B1")) %>% 
  mutate(Sample = recode(Sample, "bitterness_3" = "B3")) %>% 
  mutate(Sample = recode(Sample, "bitterness_2" =  "B2")) %>% 
  mutate(Sample = recode(Sample, "bitterness_5" =  "B5")) %>% 
  mutate(Sample = recode(Sample, "bitterness_4" =  "B4")) %>% 
  mutate(Sample = recode(Sample, "bitterness_6" =  "B6")) %>% 
  mutate(Sample = recode(Sample, "bitterness_7" = "B1")) %>% 
  mutate(Sample = recode(Sample, "bitterness_9" = "B3")) %>% 
  mutate(Sample = recode(Sample, "bitterness_8" =  "B2")) %>% 
  mutate(Sample = recode(Sample, "bitterness_11" =  "B5")) %>% 
  mutate(Sample = recode(Sample, "bitterness_10" =  "B4")) %>% 
  mutate(Sample = recode(Sample, "bitterness_12" =  "B6"))
  
SE_bitter$percent <- c(rep("17% Addition", 6), rep("8% Addition", 6))

kable(SE_bitter %>% arrange(percent, factor(Sample, levels = sample_order5)) %>% relocate(percent))

compareT <- df5closed_ratings_trim %>% filter(percent == "8% Addition" & sample2 %in% c("bitterness_7", "bitterness_9"))
```

```{r study3ClosedMilkRatings, echo=FALSE}
study3closedMilkRatings <- df5closed_ratings_trim %>% 
  filter(Sample %in% c("B1", "B3")) %>% 
  ggplot(aes(x = factor(Sample, levels = c("B1", "B3")), y = Intensity)) +
  geom_violin(linewidth = 0.5, color = "#555555")+
  facet_grid(condition ~factor(percent, levels = c("8% Addition", "17% Addition"))) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.08)), limits = c(0, 10.3)) +
  stat_summary(fun = mean, geom = "point", shape = 19, size = 2, color = "black") +
  geom_errorbar(data = SE_bitter %>% filter(Sample %in% c("B1", "B3")), 
                aes(ymin = Intensity-se, ymax = Intensity+se), width = 0.2) +
  geom_signif(data = compareT,
              y_position = 10.3, xmin = 1, xmax = 2,
              tip_length = 0,
              annotation = c("0.09")) +
  theme_bw() +
  theme(panel.grid.major = element_blank(), # remove grid lines
        panel.grid.minor = element_blank(),
        axis.title.x=element_blank(), # remove x title
        strip.text = element_text(size = 12), # facet text size
        axis.text = element_text(size = 12), # axis text size
        axis.title.y = element_text(size = 12), # y axis title size
        strip.background.y = element_blank(), #remove condition facet
        strip.text.y = element_blank()) + # remove Condition facet 
  scale_x_discrete(labels = c("Skim", "Whole", "Whole", "Whole")) +
  labs(y = "Bitterness Intensity")
```

```{r study3ClosedMilkRatingsViz, echo=FALSE, warning=FALSE, message=FALSE}
#| fig.cap = "R Index of paired comparison between skim milk and whole milk at an 8% addition level and 17% addition level in a nose closed condition. Dashed horizontal line represents the critical value, which denotes statistical significance, or discrimination between the samples on bitterness. Grey bars are not significant (p > 0.05). Red bars indicate the water sample ('Signal') was significant; White bars indicate the milk sample ('Noise') was significant (p < 0.05). Bitterness intensity ratings (from 0 - 10) are represented as violin plots showing the distribution of scaling responses. Means are presented as black dots with standard error bars."
plot_grid(study3closedMilkRViz, study3closedMilkRatings + theme(strip.background.x = element_blank(), 
        strip.text.x = element_blank()), ncol = 1)
#may want to match the milk rindex viz to the ratings viz for consistency
```
```{r study3closedWaterRatings, echo=FALSE}
study3closedWaterRatings <- df5closed_ratings_trim %>% 
  filter(Sample %in% c("B2", "B5", "B4", "B6")) %>% 
  ggplot(aes(x = factor(Sample, levels = c("B2", "B5", "B4", "B6")), y = Intensity)) +
  geom_violin(linewidth = 0.5, color = "#555555")+
  facet_grid(condition ~factor(percent, levels = c("8% Addition", "17% Addition"))) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.08)), limits = c(0,10.3)) +
  stat_summary(fun = mean, geom = "point", shape = 19, size = 2, color = "black") +
  geom_errorbar(data = SE_bitter %>% filter(Sample %in% c("B2", "B5", "B4", "B6")), aes(ymin = Intensity-se, ymax = Intensity+se), width = 0.2) +
  theme_bw() +
  theme(panel.grid.major = element_blank(), # remove grid lines
        panel.grid.minor = element_blank(),
        axis.title.x=element_blank(), # remove x title
        strip.text = element_text(size = 12), # facet text size
        axis.text = element_text(size = 12), # axis text size
        axis.title.y = element_text(size = 12), # y axis title size
        strip.background.y = element_blank(), #remove condition facet
        strip.text.y = element_blank()) + # remove Condition facet 
  geom_vline(xintercept = 2.5) +
  scale_x_discrete(labels = c("Skim", "Water", "Whole", "Water")) +
  labs(y = "Bitterness Intensity")
```

```{r study3ClosedWaterRatingsViz, echo=FALSE, warning=FALSE, message=FALSE}
#| fig.cap = "R Index of paired comparison between skim milk and water at an 8% addition level and 17% addition level in a nose closed condition. Dashed horizontal line represents the critical value, which denotes statistical significance, or discrimination between the samples on bitterness. Grey bars are not significant (p > 0.05). Red bars indicate the water sample ('Signal') was significant; White bars indicate the milk sample ('Noise') was significant (p < 0.05). Bitterness intensity ratings (from 0 - 10) are represented as violin plots showing the distribution of scaling responses. Means are presented as black dots with standard error bars."
plot_grid(study3closedWaterRViz, study3closedWaterRatings + theme(strip.background.x = element_blank(), 
        strip.text.x = element_blank()), ncol = 1)
# unconvinced of removing facet labels on ratings viz
```

## Nose Open Condition
```{r study3open data wrangling, include=FALSE, warning=FALSE, message=FALSE}
brew5opened <- read_xlsx(path = "Objective1CompiledDataWithIndex.xlsx", sheet = 9)

df5opened <- t(brew5opened) %>% as.data.frame() %>% row_to_names(row_number = 1) %>% clean_names()
chars <- sapply(df5opened, is.character)
df5opened[ ,chars] <- as.data.frame(apply(df5opened[,chars],2, as.numeric))

df5opened <- df5opened %>% rownames_to_column(var = "participant")
```

### R Index
The R critical value for a 2-tailed test (milk comparisons) is: `r Rcriti(length(df5opened$participant), length(df5opened$participant), 0.05, 2)[2]`.  

```{r study3opened rindex milks, echo=FALSE, include=FALSE}
Rcriti(length(df5opened$participant), length(df5opened$participant), 0.05, 2)
```
```{r study3opened 8% milk, include=FALSE}
df5opened %>% select(comparison_7_v_9_more_bitter, confidence_9) %>% count(comparison_7_v_9_more_bitter, confidence_9)
Milk5S8O <- RIndex(13,3,2,0,4,12,length(df5opened$participant)) 
```

- no discrimination seen between when 8% skim milk and 8% whole milk was added to coffee (R Index = `r round(as.numeric(Milk5S8O)[1], 2)`, p > 0.05)  

```{r study3opened 17% milk, include=FALSE}
df5opened %>% select(comparison_1_v_3_more_bitter, confidence_3) %>% count(comparison_1_v_3_more_bitter, confidence_3)
Milk5S17O <- RIndex(14,3,2,1,4,10,length(df5opened$participant))
```
- no discrimination seen between when 17% skim milk and 17% whole milk was added to coffee (R Index = `r round(as.numeric(Milk5S17O)[1], 2)`, p > 0.05)  

```{r study3opened r wrangling milk, include=FALSE, echo=FALSE}
Milk5ROpen <- tibble(
  Sample = "sample",
  Percent = factor(c("8% Addition", "17% Addition"),
                   levels = c("8% Addition", "17% Addition")),
  Condition = "Opened",
  Rindex = c(as.numeric(v2d(Milk5S8O, along = 1)$V1), as.numeric(v2d(Milk5S17O, along = 1)$V1)),
  Critical = as.numeric(Rcriti(length(df5closed$participant), length(df5closed$participant), 0.05, 2)[2]),
  Sig = ifelse(Rindex > Critical, "#B22222", "#888888")
)

rcritical_5O <- Milk5ROpen %>% filter(Percent == "8% Addition")


study3OpenMilkRViz <- Milk5ROpen %>% 
  ggplot(aes(x = Sample, y = Rindex)) +
  geom_col(width = 0.5, fill = Milk5ROpen$Sig, color = "black") +
  facet_grid(~Percent) +
  scale_y_continuous(expand = expansion(mult = c(0, .1)), labels = scales::percent) +
  scale_x_discrete(labels = c("Skim/Whole", "Skim/Whole")) +
  geom_hline(aes(yintercept = Critical), linetype = "longdash") +
  theme_bw() +
  labs(y = "R Index", x = "Sample") +
  geom_text(data = rcritical_5O,
            label = "R-crit", aes(y = 0.7, x = 0.6), size = 3) +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.text = element_text(size = 12), # facet text size
        axis.text = element_text(size = 10), # axis text size
        axis.title.y = element_text(size = 12),
        axis.title.x=element_blank(),
        strip.background.y = element_blank(),
        strip.text.y = element_blank()) +
  coord_cartesian(ylim = c(.5, 1)) 
```
```{r study3OpenMilkRViz, echo=FALSE, warning=FALSE, message=FALSE}
#| fig.cap = "R Index of paired comparison between skim milk and whole milk at an 8% addition level and 17% addition level in a nose open condition. Dashed horizontal line represents the critical value, which denotes statistical significance, or discrimination between the samples on bitterness. Grey bars are not significant (p > 0.05). Red bars indicate the water sample ('Signal') was significant; White bars indicate the milk sample ('Noise') was significant (p < 0.05)."
study3OpenMilkRViz
```

For the paired comparisons between milk and water, we hypothesized that the addition of milk would reduce the bitterness, therefore making the water sample the more bitter. The critical value for a one tailed R-index calculation is `r Rcriti(length(df5opened$participant), length(df5opened$participant), 0.05, 1)[2]`.  

```{r study3opened rindex water, echo=FALSE, include=FALSE}
Rcriti(length(df5opened$participant), length(df5opened$participant), 0.05, 1)
```

```{r study3opened 8% water, include=FALSE}
df5opened %>% select(comparison_8_v_11_more_bitter, confidence_11) %>% count(comparison_8_v_11_more_bitter, confidence_11)
water5S8O <- RIndex(12,0,4,2,7,9,length(df5opened$participant))

df5opened %>% select(comparison_10_v_12_more_bitter, confidence_12) %>% count(comparison_10_v_12_more_bitter, confidence_12)
water5W8O <- RIndex(11,1,2,2,4,14,length(df5opened$participant)) #p > 0.1
```

- no discrimination seen between when 8% skim milk and 8% water was added to coffee (R Index = `r round(as.numeric(water5S8O)[1], 2)`, p > 0.05)  
- no discrimination seen between when 8% whole milk and 8% water was added to coffee (R Index = `r signif(as.numeric(water5W8O)[1], 3)`, p > 0.1)   

```{r study3opened 17 water, include=FALSE}
df5opened %>% select(comparison_2_v_5_more_bitter, confidence_5) %>% count(comparison_2_v_5_more_bitter, confidence_5)
water5S17O <- RIndex(11,4,3,2,3,11,length(df5opened$participant))

df5opened %>% select(comparison_4_v_6_more_bitter, confidence_6) %>% count(comparison_4_v_6_more_bitter, confidence_6)
water5W17O <- RIndex(6,6,0,1,1,20,length(df5opened$participant))
Rcriti(length(df5opened$participant), length(df5opened$participant), 0.001, 1)

```

- no discrimination between the 17% skim milk and 17% water samples (R Index = `r round(as.numeric(water5S17O)[1], 2)`, p > 0.05)  
- discrimination seen between the 17% whole milk and 17% water samples (R Index = `r round(as.numeric(water5W17O)[1], 2)`, p $\le$ 0.001)  

```{r study3opened r wrangling water, include=FALSE, warning=FALSE, message=FALSE}
Water5ROpened <- tibble(
  Sample = factor(c(rep(c("B5", "B6"),2))),
  Percent = factor(c(rep("8% Addition",2), rep("17% Addition",2)),
                   levels = c("8% Addition", "17% Addition")),
  Condition = "Opened",  
  Rindex = c(as.numeric(v2d(water5S8O, along = 1)$V1),
             as.numeric(v2d(water5W8O, along = 1)$V1),
             as.numeric(v2d(water5S17O, along = 1)$V1),
             as.numeric(v2d(water5W17O, along = 1)$V1)),
  S.N = c((v2d(water5S8O, along = 1)$V2),
             (v2d(water5W8O, along = 1)$V2),
             (v2d(water5S17O, along = 1)$V2),
             (v2d(water5W17O, along = 1)$V2)),
  Critical = as.numeric(Rcriti(length(df5opened$participant), length(df5opened$participant), 0.05, 1)[2]),
  Sig = ifelse(Rindex > Critical & S.N == "Signal", "#B22222",
               ifelse(Rindex > Critical & S.N == "Noise", "white",
                      "#888888"))
  )

compareR <- Water5ROpened %>% 
  filter(Sig %in% "#B22222")

rcritical_5WOpened <- Water5ROpened %>% filter(Percent == "8% Addition")


study3openedWaterRViz <- Water5ROpened %>% 
  ggplot(aes(x = Sample, y = Rindex)) +
  geom_col(width = 0.5, fill = Water5ROpened$Sig, color = "black") +
  facet_grid(~factor(Percent, levels = c("8% Addition", "17% Addition"))) +
  scale_y_continuous(expand = expansion(mult = c(0, .1)), labels = scales::percent) +
  geom_hline(aes(yintercept = Critical), linetype = "longdash") +
  theme_bw() +
  labs(y = "R Index", x = "Sample") +
  scale_x_discrete(labels = c("Skim/Water", "Whole/Water", "Skim/Water", "Whole/Water")) +  
  geom_signif(data = compareR,
              y_position = 0.95, xmin = 1.8, xmax = 2.2,
              tip_length = 0,
              annotation = c("< 0.01")) +
  geom_text(data = rcritical_5WOpened,
            label = "R-crit", aes(y = 0.7, x = 0.6), size = 3) +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.text = element_text(size = 12), # facet text size
        axis.text = element_text(size = 10), # axis text size
        axis.title.y = element_text(size = 12),
        axis.title.x=element_blank(),
        strip.background.y = element_blank(),
        strip.text.y = element_blank()) +
  geom_vline(xintercept = 1.5) +
  coord_cartesian(ylim = c(.5, 1)) 
```
```{r study3OpenedWaterRViz, echo=FALSE, warning=FALSE}
#| fig.cap = "R Index of paired comparison between skim milk and water at an 8% addition level and 17% addition level in a nose opened condition. Dashed horizontal line represents the critical value, which denotes statistical significance, or discrimination between the samples on bitterness. Grey bars are not significant (p > 0.05). Red bars indicate the water sample ('Signal') was significant; White bars indicate the milk sample ('Noise') was significant (p < 0.05)."
study3openedWaterRViz
```

- In the nose open condition, only the 17% water sample was discriminated against the 17% whole milk sample on bitterness.  
  + These two samples were not discriminated in the nose closed condition (see \@ref(fig:study3ClosedWaterRViz))  

### Ratings  
```{r study3opened ratings wrangling, include=FALSE}
df5opened_ratings <- df5opened %>% select(participant, starts_with("bitterness"))

df5opened_ratings_long <- df5opened_ratings %>% 
  pivot_longer(-participant, names_to = "Sample", values_to = "Intensity")
```

```{r study3KableOpenRatings, echo=FALSE}
kable(summarySE(df5opened_ratings_long, measurevar = "Intensity", groupvars = "Sample") %>% select(Sample, Intensity, sd, se) %>%  arrange(factor(Sample, levels = sample_order5)),
      caption = "Bitterness intensities, standard deviation, and standard error of cold brew coffee samples evaluated in nose opened condition. Each 2 rows represent the two samples presented in a paired comparison format.")
# may want to learn how to create tables in LaTeX
```


```{r study3opened t-test, collapse=TRUE, comment=""}
t.test(df5opened$bitterness_7, df5opened$bitterness_9, 
       paired = TRUE, alternative = "two.sided") 
t.test(df5opened$bitterness_11, df5opened$bitterness_8, 
       paired = TRUE, alternative = "greater")
t.test(df5opened$bitterness_12, df5opened$bitterness_10, 
       paired = TRUE, alternative = "greater")

t.test(df5opened$bitterness_1, df5opened$bitterness_3, 
       paired = TRUE, alternative = "two.sided")
t.test(df5opened$bitterness_5, df5opened$bitterness_2, 
       paired = TRUE, alternative = "greater")
t.test(df5opened$bitterness_6, df5opened$bitterness_4, 
       paired = TRUE, alternative = "greater")
```

- NSD between 8% skim and whole milk (t = `r round(t.test(df5opened$bitterness_7, df5opened$bitterness_9, paired = TRUE, alternative = "two.sided")$statistic,2)`, p = `r round(t.test(df5opened$bitterness_7, df5opened$bitterness_9, paired = TRUE, alternative = "two.sided")$p.value, 3)`)
- NSD between 8% skim and 8% water ratings (t = `r round(t.test(df5opened$bitterness_11, df5opened$bitterness_8, paired = TRUE, alternative = "greater")$statistic,2)`, p = `r signif(t.test(df5opened$bitterness_11, df5opened$bitterness_8, paired = TRUE, alternative = "greater")$p.value,2)`)  
- marginal reduction between 8% whole milk and 8% water ratings (t = `r round(t.test(df5opened$bitterness_10, df5opened$bitterness_12, paired = TRUE, alternative = "greater")$statistic,2)`, p = `r signif(t.test(df5opened$bitterness_12, df5opened$bitterness_10, paired = TRUE, alternative = "greater")$p.value, 2)`)  

- NSD between 17% skim and 17% whole milk ratings (t = `r round(t.test(df5opened$bitterness_1, df5opened$bitterness_3, paired = TRUE, alternative = "two.sided")$statistic,2)`, p = `r signif(t.test(df5opened$bitterness_1, df5opened$bitterness_3, paired = TRUE, alternative = "two.sided")$p.value,2)`)  
- NSD between 17% skim and 17% water ratings (t = `r round(t.test(df5opened$bitterness_5, df5opened$bitterness_2, paired = TRUE, alternative = "greater")$statistic,2)`, p = `r signif(t.test(df5opened$bitterness_5, df5opened$bitterness_2, paired = TRUE, alternative = "greater")$p.value,2)`)  
- significant reduction between 17% whole milk and 17% water ratings (t = `r round(t.test(df5opened$bitterness_6, df5opened$bitterness_4, paired = TRUE, alternative = "greater")$statistic,2)`, p = `r signif(t.test(df5opened$bitterness_6, df5opened$bitterness_4, paired = TRUE, alternative = "greater")$p.value,2)`)  


```{r study3opened viz wrangling, include=FALSE}
df5opened_ratings_long2 <- df5opened_ratings_long
length(df5opened$participant) # 34
length(df5opened_ratings_long2$participant) # 408
df5opened_ratings_long2$condition <- rep("Opened", 408)
df5opened_ratings_long2$addition <- rep(c("Skim", "Whole", "Skim", "Water", "Whole", "Water"), 68) 
df5opened_ratings_long2$percent <- rep(c(rep("17% Addition", 6), rep("8% Addition", 6)), 34)
df5opened_ratings_long2$sample2 <- df5opened_ratings_long2$Sample

df5opened_ratings_trim <- df5opened_ratings_long2 %>% 
  mutate(Sample = recode(Sample, "bitterness_1" = "B1")) %>% 
  mutate(Sample = recode(Sample, "bitterness_3" = "B3")) %>% 
  mutate(Sample = recode(Sample, "bitterness_2" =  "B2")) %>% 
  mutate(Sample = recode(Sample, "bitterness_5" =  "B5")) %>% 
  mutate(Sample = recode(Sample, "bitterness_4" =  "B4")) %>% 
  mutate(Sample = recode(Sample, "bitterness_6" =  "B6")) %>% 
  mutate(Sample = recode(Sample, "bitterness_7" = "B1")) %>% 
  mutate(Sample = recode(Sample, "bitterness_9" = "B3")) %>% 
  mutate(Sample = recode(Sample, "bitterness_8" =  "B2")) %>% 
  mutate(Sample = recode(Sample, "bitterness_11" =  "B5")) %>% 
  mutate(Sample = recode(Sample, "bitterness_10" =  "B4")) %>% 
  mutate(Sample = recode(Sample, "bitterness_12" =  "B6"))


SE_bitter_opened <- summarySE(df5opened_ratings_long, measurevar = "Intensity", groupvars = "Sample") %>% 
  select(Sample, Intensity, se) %>% 
  arrange(factor(Sample, levels = sample_order5)) %>% 
  mutate(Sample = recode(Sample, "bitterness_1" = "B1")) %>% 
  mutate(Sample = recode(Sample, "bitterness_3" = "B3")) %>% 
  mutate(Sample = recode(Sample, "bitterness_2" =  "B2")) %>% 
  mutate(Sample = recode(Sample, "bitterness_5" =  "B5")) %>% 
  mutate(Sample = recode(Sample, "bitterness_4" =  "B4")) %>% 
  mutate(Sample = recode(Sample, "bitterness_6" =  "B6")) %>% 
  mutate(Sample = recode(Sample, "bitterness_7" = "B1")) %>% 
  mutate(Sample = recode(Sample, "bitterness_9" = "B3")) %>% 
  mutate(Sample = recode(Sample, "bitterness_8" =  "B2")) %>% 
  mutate(Sample = recode(Sample, "bitterness_11" =  "B5")) %>% 
  mutate(Sample = recode(Sample, "bitterness_10" =  "B4")) %>% 
  mutate(Sample = recode(Sample, "bitterness_12" =  "B6"))
  
SE_bitter_opened$percent <- c(rep("17% Addition", 6), rep("8% Addition", 6))

kable(SE_bitter_opened %>% arrange(percent, factor(Sample, levels = sample_order5)) %>% relocate(percent))

compareS <- df5opened_ratings_trim %>% filter(percent == "17% Addition" & sample2 %in% c("bitterness_4", "bitterness_6"))
compareT <- df5opened_ratings_trim %>% filter(percent == "8% Addition" & sample2 %in% c("bitterness_10", "bitterness_12"))
```

```{r study3OpenedMilkRatings, echo=FALSE}
study3openedMilkRatings <- df5opened_ratings_trim %>% 
  filter(Sample %in% c("B1", "B3")) %>% 
  ggplot(aes(x = factor(Sample, levels = c("B1", "B3")), y = Intensity)) +
  geom_violin(linewidth = 0.5, color = "#555555")+
  facet_grid(condition ~factor(percent, levels = c("8% Addition", "17% Addition"))) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.08)), limits = c(0,10.3)) +
  stat_summary(fun = mean, geom = "point", shape = 19, size = 2, color = "black") +
  geom_errorbar(data = SE_bitter_opened %>% filter(Sample %in% c("B1", "B3")), aes(ymin = Intensity-se, ymax = Intensity+se), width = 0.2) +
  theme_bw() +
  theme(panel.grid.major = element_blank(), # remove grid lines
        panel.grid.minor = element_blank(),
        axis.title.x=element_blank(), # remove x title
        strip.text = element_text(size = 12), # facet text size
        axis.text = element_text(size = 12), # axis text size
        axis.title.y = element_text(size = 12), # y axis title size
        strip.background.y = element_blank(), #remove condition facet
        strip.text.y = element_blank()) + # remove Condition facet 
  scale_x_discrete(labels = c("Skim", "Whole", "Whole", "Whole")) +
  labs(y = "Bitterness Intensity")
```

```{r study3OpenedMilkRatingsViz, echo=FALSE, warning=FALSE, message=FALSE}
#| fig.cap = "R Index of paired comparison between skim milk and whole milk at an 8% addition level and 17% addition level in a nose opened condition. Dashed horizontal line represents the critical value, which denotes statistical significance, or discrimination between the samples on bitterness. Grey bars are not significant (p > 0.05). Red bars indicate the water sample ('Signal') was significant; White bars indicate the milk sample ('Noise') was significant (p < 0.05). Bitterness intensity ratings (from 0 - 10) are represented as violin plots showing the distribution of scaling responses. Means are presented as black dots with standard error bars."
plot_grid(study3OpenMilkRViz, study3openedMilkRatings + theme(strip.background.x = element_blank(), 
        strip.text.x = element_blank()), ncol = 1)
```
```{r study3OpenedWaterRatings, echo=FALSE}
study3openedWaterRatings <- df5opened_ratings_trim %>% 
  filter(Sample %in% c("B2", "B5", "B4", "B6")) %>% 
  ggplot(aes(x = factor(Sample, levels = c("B2", "B5", "B4", "B6")), y = Intensity)) +
  geom_violin(linewidth = 0.5, color = "#555555")+
  facet_grid(condition ~factor(percent, levels = c("8% Addition", "17% Addition"))) +
  scale_y_continuous(expand = expansion(mult = c(0, 0.08)), limits = c(0,10.3)) +
  stat_summary(fun = mean, geom = "point", shape = 19, size = 2, color = "black") +
  geom_errorbar(data = SE_bitter_opened %>% filter(Sample %in% c("B2", "B5", "B4", "B6")), aes(ymin = Intensity-se, ymax = Intensity+se), width = 0.2) +
  theme_bw() +
  geom_signif(data = compareS,
              y_position = 10.1, xmin = 3, xmax = 4,
              tip_length = 0,
              annotation = c("< 0.001")) +  
  geom_signif(data = compareT,
              y_position = 10.1, xmin = 3, xmax = 4,
              tip_length = 0,
              annotation = c("0.10")) + 
  theme(panel.grid.major = element_blank(), # remove grid lines
        panel.grid.minor = element_blank(),
        axis.title.x=element_blank(), # remove x title
        strip.text = element_text(size = 12), # facet text size
        axis.text = element_text(size = 12), # axis text size
        axis.title.y = element_text(size = 12), # y axis title size
        strip.background.y = element_blank(), #remove condition facet
        strip.text.y = element_blank()) + # remove Condition facet 
  geom_vline(xintercept = 2.5) +
  scale_x_discrete(labels = c("Skim", "Water", "Whole", "Water")) +
  labs(y = "Bitterness Intensity")
```

```{r study3OpenedWaterRatingsViz, echo=FALSE, warning=FALSE, message=FALSE}
#| fig.cap = "R Index of paired comparison between skim milk and water at an 8% addition level and 17% addition level in a nose opened condition. Dashed horizontal line represents the critical value, which denotes statistical significance, or discrimination between the samples on bitterness. Grey bars are not significant (p > 0.05). Red bars indicate the water sample ('Signal') was significant; White bars indicate the milk sample ('Noise') was significant (p < 0.05). Bitterness intensity ratings (from 0 - 10) are represented as violin plots showing the distribution of scaling responses. Means are presented as black dots with standard error bars."
plot_grid(study3openedWaterRViz, study3openedWaterRatings + theme(strip.background.x = element_blank(), 
        strip.text.x = element_blank()), ncol = 1)
# unconvinced of removing facet labels on ratings viz
```

### Comparison of Conditions (R-index) 

```{r study3Milk5Combine wrangling, include=FALSE}
Milk5RCombine <- full_join(Milk5R, Milk5ROpen)

Milk5RCombineViz <- Milk5RCombine %>% 
  ggplot(aes(x = Sample, y = Rindex)) +
  geom_col(width = 0.5, fill = Milk5RCombine$Sig, color = "black") +
  facet_grid(Condition~Percent) +
  scale_y_continuous(expand = expansion(mult = c(0, .1)), labels = scales::percent) +
  scale_x_discrete(labels = c("Skim/Whole", "Skim/Whole")) +
  geom_hline(aes(yintercept = Critical), linetype = "longdash") +
  theme_bw() +
  labs(y = "R Index", x = "Sample") +
  geom_text(data = rcritical_5,
            label = "R-crit", aes(y = 0.7, x = 0.6), size = 3) +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.text = element_text(size = 12), # facet text size
        axis.text = element_text(size = 10), # axis text size
        axis.title.y = element_text(size = 12),
        axis.title.x=element_blank()) +
  coord_cartesian(ylim = c(.5, 1)) 
```
```{r study3MilkCombineRViz, echo=FALSE}
#| fig.cap = "R Index of paired comparison between skim milk and whole milk at an 8% addition level and 17% addition level in a nose closed and nose opened condition. Dashed horizontal line represents the critical value, which denotes statistical significance, or discrimination between the samples on bitterness. Grey bars are not significant (p > 0.05). Red bars indicate the water sample (â€˜Signalâ€™) was significant; White bars indicate the milk sample (â€˜Noiseâ€™) was significant (p < 0.05)." 
Milk5RCombineViz
```

- Figure \@ref(fig:study3MilkCombineRViz) shows no discrimination in bitterness between when skim milk or whole milk was added to cold brew coffee concentrate  

```{r study3Water5RCombineViz wrangling, include=FALSE, warning=FALSE}
Water5RCombine <- full_join(Water5R, Water5ROpened)
Water5RCombineViz <- Water5RCombine %>% 
  ggplot(aes(x = Sample, y = Rindex)) +
  geom_col(width = 0.5, fill = Water5RCombine$Sig, color = "black") +
  facet_grid(Condition~factor(Percent, levels = c("8% Addition", "17% Addition"))) +
  scale_y_continuous(expand = expansion(mult = c(0, .1)), labels = scales::percent) +
  geom_hline(aes(yintercept = Critical), linetype = "longdash") +
  theme_bw() +
  labs(y = "R Index", x = "Sample") +
  scale_x_discrete(labels = c("Skim/Water", "Whole/Water", "Skim/Water", "Whole/Water")) +  
  geom_signif(data = compareR,
              y_position = 0.95, xmin = 1.8, xmax = 2.2,
              tip_length = 0,
              annotation = c("< 0.01")) +
  geom_text(data = rcritical_5WOpened,
            label = "R-crit", aes(y = 0.7, x = 0.6), size = 3) +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        strip.text = element_text(size = 12), # facet text size
        axis.text = element_text(size = 10), # axis text size
        axis.title.y = element_text(size = 12),
        axis.title.x=element_blank()) +
  geom_vline(xintercept = 1.5) +
  coord_cartesian(ylim = c(.5, 1))
```
```{r study3WaterCombineRViz, echo=FALSE, warning=FALSE}
#| fig.cap = "R Index of paired comparison between skim milk, whole milk, and water at an 8% addition level and 17% addition level in a nose closed and nose opened condition. Dashed horizontal line represents the critical value, which denotes statistical significance, or discrimination between the samples on bitterness. Grey bars are not significant (p > 0.05). Red bars indicate the water sample (â€˜Signalâ€™) was significant; White bars indicate the milk sample (â€˜Noiseâ€™) was significant (p < 0.05)." 
Water5RCombineViz
```

- Figure \@ref(fig:study3WaterCombineRViz) shows that only the 17% whole milk was able to be discriminated from the 17% water addition.
  + how does this compare to Figure \@ref(fig:study1WaterCombineRViz)?

